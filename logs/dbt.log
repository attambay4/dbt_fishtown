2020-10-12 00:24:09.366169 (MainThread): Running with dbt=0.17.0
2020-10-12 00:24:09.371051 (MainThread): Profile not loaded due to error: Runtime Error
  Could not find profile named 'default'
2020-10-12 00:24:09.371051 (MainThread): No profile "default" found, continuing with no target
2020-10-12 00:24:09.418924 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, strict=False, target=None, test_new_parser=False, use_cache=True, vars='{}', warn_error=False, which='deps', write_json=True)
2020-10-12 00:24:09.421882 (MainThread): Tracking: do not track
2020-10-12 00:24:09.422919 (MainThread): Warning: No packages were found in packages.yml
2020-10-12 00:24:09.423876 (MainThread): Flushing usage events
2020-10-12 00:37:57.645915 (MainThread): Running with dbt=0.17.0
2020-10-12 00:37:58.143619 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 00:37:58.144554 (MainThread): Tracking: tracking
2020-10-12 00:37:58.144554 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0535CDA8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05FF3418>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05FF3298>]}
2020-10-12 00:37:58.178953 (MainThread): Partial parsing not enabled
2020-10-12 00:37:58.187975 (MainThread): Parsing macros\core.sql
2020-10-12 00:37:58.195970 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 00:37:58.281743 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 00:37:58.300732 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 00:37:58.303685 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 00:37:58.307674 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 00:37:58.311662 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 00:37:58.313657 (MainThread): Parsing macros\etc\query.sql
2020-10-12 00:37:58.316790 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 00:37:58.331448 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 00:37:58.355388 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 00:37:58.359377 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 00:37:58.372342 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 00:37:58.404289 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 00:37:58.454126 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 00:37:58.458362 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 00:37:58.492073 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 00:37:58.507209 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 00:37:58.516188 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 00:37:58.529153 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 00:37:58.533143 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 00:37:58.535138 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 00:37:58.538130 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 00:37:58.544112 (MainThread): Parsing macros\adapters.sql
2020-10-12 00:37:58.572710 (MainThread): Parsing macros\catalog.sql
2020-10-12 00:37:58.581722 (MainThread): Parsing macros\etc.sql
2020-10-12 00:37:58.583688 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 00:37:58.607653 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 00:37:58.611710 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 00:37:58.615476 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 00:37:58.633463 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 00:37:58.666378 (MainThread): Partial parsing not enabled
2020-10-12 00:37:58.721200 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.my_first_dbt_model".
2020-10-12 00:37:58.721200 (MainThread): Opening a new connection, currently in state init
2020-10-12 00:37:58.766109 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.my_second_dbt_model".
2020-10-12 00:37:58.766109 (MainThread): Opening a new connection, currently in state closed
2020-10-12 00:37:59.082219 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 00:37:59.084178 (MainThread): 
2020-10-12 00:37:59.084178 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 00:37:59.084178 (MainThread): Opening a new connection, currently in state closed
2020-10-12 00:37:59.092158 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 00:37:59.092158 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 00:37:59.476156 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 00:37:59.477153 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 00:37:59.478150 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 00:37:59.913985 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 00:37:59.914981 (MainThread): Opening a new connection, currently in state closed
2020-10-12 00:37:59.914981 (MainThread): 20:37:59 | Concurrency: 1 threads (target='dev')
2020-10-12 00:37:59.915979 (MainThread): 20:37:59 | 
2020-10-12 00:37:59.929942 (Thread-1): Began running node model.jaffle_shop.my_first_dbt_model
2020-10-12 00:37:59.930939 (Thread-1): 20:37:59 | 1 of 2 START table model dbt_atambay.my_first_dbt_model.............. [RUN]
2020-10-12 00:37:59.935927 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.my_first_dbt_model".
2020-10-12 00:37:59.936924 (Thread-1): Opening a new connection, currently in state init
2020-10-12 00:37:59.937926 (Thread-1): Compiling model.jaffle_shop.my_first_dbt_model
2020-10-12 00:37:59.983798 (Thread-1): Writing injected SQL for node "model.jaffle_shop.my_first_dbt_model"
2020-10-12 00:37:59.987791 (Thread-1): finished collecting timing info
2020-10-12 00:38:00.053611 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 00:38:00.578985 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.my_first_dbt_model"
2020-10-12 00:38:00.581977 (Thread-1): On model.jaffle_shop.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.my_first_dbt_model"} */


  create or replace table `fishtown-interview-292223`.`dbt_atambay`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2020-10-12 00:38:02.433394 (Thread-1): finished collecting timing info
2020-10-12 00:38:02.434393 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f7d43c0-7d7e-41f6-8b9e-c8fc1124f942', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0612AFB8>]}
2020-10-12 00:38:02.436389 (Thread-1): 20:38:02 | 1 of 2 OK created table model dbt_atambay.my_first_dbt_model......... [CREATE TABLE (2) in 2.50s]
2020-10-12 00:38:02.437383 (Thread-1): Finished running node model.jaffle_shop.my_first_dbt_model
2020-10-12 00:38:02.438382 (Thread-1): Began running node model.jaffle_shop.my_second_dbt_model
2020-10-12 00:38:02.441380 (Thread-1): 20:38:02 | 2 of 2 START view model dbt_atambay.my_second_dbt_model.............. [RUN]
2020-10-12 00:38:02.446363 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.my_second_dbt_model".
2020-10-12 00:38:02.446363 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.my_first_dbt_model).
2020-10-12 00:38:02.447359 (Thread-1): Compiling model.jaffle_shop.my_second_dbt_model
2020-10-12 00:38:02.473288 (Thread-1): Writing injected SQL for node "model.jaffle_shop.my_second_dbt_model"
2020-10-12 00:38:02.475283 (Thread-1): finished collecting timing info
2020-10-12 00:38:02.534128 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.my_second_dbt_model"
2020-10-12 00:38:02.536122 (Thread-1): On model.jaffle_shop.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.my_second_dbt_model"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `fishtown-interview-292223`.`dbt_atambay`.`my_first_dbt_model`
where id = 1;


2020-10-12 00:38:03.352907 (Thread-1): finished collecting timing info
2020-10-12 00:38:03.354845 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f7d43c0-7d7e-41f6-8b9e-c8fc1124f942', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x060D2E50>]}
2020-10-12 00:38:03.356840 (Thread-1): 20:38:03 | 2 of 2 OK created view model dbt_atambay.my_second_dbt_model......... [CREATE VIEW in 0.91s]
2020-10-12 00:38:03.358835 (Thread-1): Finished running node model.jaffle_shop.my_second_dbt_model
2020-10-12 00:38:03.360832 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 00:38:03.360832 (MainThread): Opening a new connection, currently in state closed
2020-10-12 00:38:03.360832 (MainThread): 20:38:03 | 
2020-10-12 00:38:03.363821 (MainThread): 20:38:03 | Finished running 1 table model, 1 view model in 4.28s.
2020-10-12 00:38:03.364819 (MainThread): Connection 'master' was properly closed.
2020-10-12 00:38:03.364819 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 00:38:03.364819 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 00:38:03.364819 (MainThread): Connection 'model.jaffle_shop.my_second_dbt_model' was left open.
2020-10-12 00:38:03.376789 (MainThread): unclosed <socket.socket fd=572, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55278, 0, 0), raddr=('2607:f8b0:4004:800::200a', 443, 0, 0)>
2020-10-12 00:38:03.377787 (MainThread): unclosed <socket.socket fd=484, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55279, 0, 0), raddr=('2607:f8b0:4004:808::200a', 443, 0, 0)>
2020-10-12 00:38:03.378782 (MainThread): unclosed <socket.socket fd=1144, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55280, 0, 0), raddr=('2607:f8b0:4004:800::200a', 443, 0, 0)>
2020-10-12 00:38:03.378782 (MainThread): unclosed <socket.socket fd=840, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55281, 0, 0), raddr=('2607:f8b0:4004:808::200a', 443, 0, 0)>
2020-10-12 00:38:03.379781 (MainThread): unclosed <socket.socket fd=1016, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55283, 0, 0), raddr=('2607:f8b0:4004:808::200a', 443, 0, 0)>
2020-10-12 00:38:03.379781 (MainThread): unclosed <socket.socket fd=740, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=0, laddr=('2600:8806:4000:301:2112:7fbd:e012:c3c', 55282, 0, 0), raddr=('2607:f8b0:4004:800::200a', 443, 0, 0)>
2020-10-12 00:38:03.381774 (MainThread): 
2020-10-12 00:38:03.382771 (MainThread): Completed successfully
2020-10-12 00:38:03.383769 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2020-10-12 00:38:03.384765 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06182CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06173838>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x061730A0>]}
2020-10-12 00:38:03.384765 (MainThread): Flushing usage events
2020-10-12 01:42:10.661781 (MainThread): Running with dbt=0.17.0
2020-10-12 01:42:11.053473 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:42:11.054472 (MainThread): Tracking: tracking
2020-10-12 01:42:11.054472 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x056D1FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063623B8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06362400>]}
2020-10-12 01:42:11.078812 (MainThread): Partial parsing not enabled
2020-10-12 01:42:11.083805 (MainThread): Parsing macros\core.sql
2020-10-12 01:42:11.088766 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:42:11.149605 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:42:11.159974 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:42:11.162281 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:42:11.164276 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:42:11.167269 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:42:11.170262 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:42:11.171260 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:42:11.179673 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:42:11.193681 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:42:11.196775 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:42:11.204866 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:42:11.227737 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:42:11.264682 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:42:11.267636 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:42:11.285584 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:42:11.292831 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:42:11.301848 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:42:11.308791 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:42:11.311824 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:42:11.312821 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:42:11.313819 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:42:11.316770 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:42:11.335719 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:42:11.342700 (MainThread): Parsing macros\etc.sql
2020-10-12 01:42:11.344694 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:42:11.362646 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:42:11.365639 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:42:11.369628 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:42:11.389576 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:42:11.417504 (MainThread): Partial parsing not enabled
2020-10-12 01:42:11.456429 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:42:11.456429 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:42:11.481367 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:42:11.481367 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:11.491343 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:42:11.491343 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:11.499322 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:42:11.499322 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:11.508299 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:42:11.508299 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:11.610286 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:42:11.671083 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:42:11.672080 (MainThread): 
2020-10-12 01:42:11.673078 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:11.673078 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:11.683052 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:42:11.684051 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:42:12.059575 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:42:12.059575 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:42:12.060573 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:42:12.455525 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:12.455525 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:12.455525 (MainThread): 21:42:12 | Concurrency: 1 threads (target='dev')
2020-10-12 01:42:12.456513 (MainThread): 21:42:12 | 
2020-10-12 01:42:12.463495 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:42:12.464492 (Thread-1): 21:42:12 | 1 of 5 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:42:12.465489 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:42:12.466487 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:42:12.466487 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:42:12.499401 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:42:12.501395 (Thread-1): finished collecting timing info
2020-10-12 01:42:12.549265 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:42:12.551261 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:42:13.405031 (Thread-1): finished collecting timing info
2020-10-12 01:42:13.405031 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca314509-9d37-47ac-be96-bfcd8e2fe7ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065380D0>]}
2020-10-12 01:42:13.406071 (Thread-1): 21:42:13 | 1 of 5 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.94s]
2020-10-12 01:42:13.408023 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:42:13.408023 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:42:13.409020 (Thread-1): 21:42:13 | 2 of 5 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:42:13.421986 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:42:13.421986 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:42:13.421986 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:42:13.430962 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:42:13.431959 (Thread-1): finished collecting timing info
2020-10-12 01:42:13.443927 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:42:13.445926 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as eslect * from `fa--interview-task.interview.devices`;


2020-10-12 01:42:13.620793 (Thread-1): finished collecting timing info
2020-10-12 01:42:13.621791 (Thread-1): Database Error in model devices (models\base\devices.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got identifier "eslect" at [6:6]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got identifier "eslect" at [6:6]

(job ID: 45f16efb-9620-4a53-a553-5ab560702d04)

                                                      -----Query Job SQL Follows-----                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
   5:  OPTIONS()
   6:  as eslect * from `fa--interview-task.interview.devices`;
   7:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model devices (models\base\devices.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got identifier "eslect" at [6:6]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:42:13.632762 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca314509-9d37-47ac-be96-bfcd8e2fe7ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064E1178>]}
2020-10-12 01:42:13.633759 (Thread-1): 21:42:13 | 2 of 5 ERROR creating view model dbt_atambay.devices................. [ERROR in 0.21s]
2020-10-12 01:42:13.634797 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:42:13.634797 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:42:13.636750 (Thread-1): 21:42:13 | 3 of 5 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:42:13.639744 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:42:13.639744 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:42:13.640740 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:42:13.647721 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:42:13.648721 (Thread-1): finished collecting timing info
2020-10-12 01:42:13.655701 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:42:13.656700 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:42:14.372791 (Thread-1): finished collecting timing info
2020-10-12 01:42:14.373821 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca314509-9d37-47ac-be96-bfcd8e2fe7ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064E5310>]}
2020-10-12 01:42:14.374786 (Thread-1): 21:42:14 | 3 of 5 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.73s]
2020-10-12 01:42:14.375783 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:42:14.375783 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:42:14.376782 (Thread-1): 21:42:14 | 4 of 5 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:42:14.379774 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:42:14.380770 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:42:14.380770 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:42:14.389746 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:42:14.390743 (Thread-1): finished collecting timing info
2020-10-12 01:42:14.395734 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:42:14.396727 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:42:15.307233 (Thread-1): finished collecting timing info
2020-10-12 01:42:15.307233 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca314509-9d37-47ac-be96-bfcd8e2fe7ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0719AE80>]}
2020-10-12 01:42:15.308196 (Thread-1): 21:42:15 | 4 of 5 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.93s]
2020-10-12 01:42:15.310200 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:42:15.310200 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:42:15.311154 (Thread-1): 21:42:15 | 5 of 5 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:42:15.312145 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:42:15.312145 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:42:15.312145 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:42:15.318161 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:42:15.319160 (Thread-1): finished collecting timing info
2020-10-12 01:42:15.324113 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:42:15.325152 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:42:16.536446 (Thread-1): finished collecting timing info
2020-10-12 01:42:16.536446 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca314509-9d37-47ac-be96-bfcd8e2fe7ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06595B20>]}
2020-10-12 01:42:16.538441 (Thread-1): 21:42:16 | 5 of 5 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 1.22s]
2020-10-12 01:42:16.539453 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:42:16.541432 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:16.541432 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:16.542430 (MainThread): 21:42:16 | 
2020-10-12 01:42:16.543428 (MainThread): 21:42:16 | Finished running 5 view models in 4.87s.
2020-10-12 01:42:16.544424 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:42:16.544424 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:42:16.544424 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:42:16.544424 (MainThread): Connection 'model.jaffle_shop.payments' was left open.
2020-10-12 01:42:16.564371 (MainThread): 
2020-10-12 01:42:16.565369 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 01:42:16.569358 (MainThread): 
2020-10-12 01:42:16.569358 (MainThread): Database Error in model devices (models\base\devices.sql)
2020-10-12 01:42:16.571358 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got identifier "eslect" at [6:6]
2020-10-12 01:42:16.587310 (MainThread):   compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:42:16.610251 (MainThread): 
Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2020-10-12 01:42:16.613244 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06595B20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064D2A48>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064D2988>]}
2020-10-12 01:42:16.614238 (MainThread): Flushing usage events
2020-10-12 01:42:27.643589 (MainThread): Running with dbt=0.17.0
2020-10-12 01:42:27.963878 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:42:27.964877 (MainThread): Tracking: tracking
2020-10-12 01:42:27.964877 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0504CDA8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05CE2418>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05CE2298>]}
2020-10-12 01:42:27.985781 (MainThread): Partial parsing not enabled
2020-10-12 01:42:27.989771 (MainThread): Parsing macros\core.sql
2020-10-12 01:42:27.993813 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:42:28.045622 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:42:28.056632 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:42:28.057631 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:42:28.058627 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:42:28.060620 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:42:28.062616 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:42:28.063615 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:42:28.072592 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:42:28.087510 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:42:28.089503 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:42:28.095487 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:42:28.117429 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:42:28.146390 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:42:28.148388 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:42:28.165380 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:42:28.176272 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:42:28.181336 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:42:28.189236 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:42:28.191231 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:42:28.192229 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:42:28.193226 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:42:28.195220 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:42:28.214171 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:42:28.221151 (MainThread): Parsing macros\etc.sql
2020-10-12 01:42:28.222148 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:42:28.238106 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:42:28.240100 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:42:28.243092 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:42:28.254106 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:42:28.276005 (MainThread): Partial parsing not enabled
2020-10-12 01:42:28.313949 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:42:28.313949 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:42:28.340872 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:42:28.340872 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:28.348848 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:42:28.348848 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:28.357827 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:42:28.357827 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:28.366762 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:42:28.366762 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:28.469487 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:42:28.509518 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:42:28.513007 (MainThread): 
2020-10-12 01:42:28.514005 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:28.514005 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:28.524976 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:42:28.524976 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:42:28.851869 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:42:28.852866 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:42:28.853863 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:42:29.161103 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:29.162042 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:29.162042 (MainThread): 21:42:29 | Concurrency: 1 threads (target='dev')
2020-10-12 01:42:29.163037 (MainThread): 21:42:29 | 
2020-10-12 01:42:29.169022 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:42:29.171016 (Thread-1): 21:42:29 | 1 of 5 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:42:29.181987 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:42:29.181987 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:42:29.181987 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:42:29.216892 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:42:29.219885 (Thread-1): finished collecting timing info
2020-10-12 01:42:29.288700 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:42:29.290695 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:42:30.148762 (Thread-1): finished collecting timing info
2020-10-12 01:42:30.149820 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd05402e-1427-42c0-9fa7-6429e898e2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBB070>]}
2020-10-12 01:42:30.151753 (Thread-1): 21:42:30 | 1 of 5 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.97s]
2020-10-12 01:42:30.153748 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:42:30.153748 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:42:30.156741 (Thread-1): 21:42:30 | 2 of 5 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:42:30.158735 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:42:30.158735 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:42:30.158735 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:42:30.170704 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:42:30.171700 (Thread-1): finished collecting timing info
2020-10-12 01:42:30.177685 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:42:30.178682 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-12 01:42:30.828952 (Thread-1): finished collecting timing info
2020-10-12 01:42:30.829950 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd05402e-1427-42c0-9fa7-6429e898e2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EB42C8>]}
2020-10-12 01:42:30.830886 (Thread-1): 21:42:30 | 2 of 5 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 0.67s]
2020-10-12 01:42:30.832917 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:42:30.832917 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:42:30.833909 (Thread-1): 21:42:30 | 3 of 5 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:42:30.835873 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:42:30.835873 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:42:30.835873 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:42:30.850865 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:42:30.851830 (Thread-1): finished collecting timing info
2020-10-12 01:42:30.858810 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:42:30.859809 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:42:31.530788 (Thread-1): finished collecting timing info
2020-10-12 01:42:31.531785 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd05402e-1427-42c0-9fa7-6429e898e2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EC07F0>]}
2020-10-12 01:42:31.533780 (Thread-1): 21:42:31 | 3 of 5 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.70s]
2020-10-12 01:42:31.534776 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:42:31.534776 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:42:31.537768 (Thread-1): 21:42:31 | 4 of 5 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:42:31.539764 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:42:31.539764 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:42:31.539764 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:42:31.550766 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:42:31.551735 (Thread-1): finished collecting timing info
2020-10-12 01:42:31.560706 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:42:31.561705 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:42:32.372286 (Thread-1): finished collecting timing info
2020-10-12 01:42:32.373285 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd05402e-1427-42c0-9fa7-6429e898e2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A95058>]}
2020-10-12 01:42:32.374248 (Thread-1): 21:42:32 | 4 of 5 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.83s]
2020-10-12 01:42:32.375701 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:42:32.376701 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:42:32.377731 (Thread-1): 21:42:32 | 5 of 5 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:42:32.379885 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:42:32.380887 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:42:32.380887 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:42:32.387871 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:42:32.388904 (Thread-1): finished collecting timing info
2020-10-12 01:42:32.394890 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:42:32.395887 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:42:33.235663 (Thread-1): finished collecting timing info
2020-10-12 01:42:33.235663 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd05402e-1427-42c0-9fa7-6429e898e2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A7A5F8>]}
2020-10-12 01:42:33.237657 (Thread-1): 21:42:33 | 5 of 5 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.86s]
2020-10-12 01:42:33.239652 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:42:33.240650 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:42:33.240650 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:42:33.240650 (MainThread): 21:42:33 | 
2020-10-12 01:42:33.241647 (MainThread): 21:42:33 | Finished running 5 view models in 4.73s.
2020-10-12 01:42:33.242646 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:42:33.242646 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:42:33.242646 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:42:33.242646 (MainThread): Connection 'model.jaffle_shop.payments' was left open.
2020-10-12 01:42:33.255611 (MainThread): 
2020-10-12 01:42:33.255611 (MainThread): Completed successfully
2020-10-12 01:42:33.266581 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2020-10-12 01:42:33.267578 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBBCE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBB5B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBBA18>]}
2020-10-12 01:42:33.267578 (MainThread): Flushing usage events
2020-10-12 01:55:56.689166 (MainThread): Running with dbt=0.17.0
2020-10-12 01:55:57.048242 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:55:57.048242 (MainThread): Tracking: tracking
2020-10-12 01:55:57.049205 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x057B1FE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064412E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064413E8>]}
2020-10-12 01:55:57.071183 (MainThread): Partial parsing not enabled
2020-10-12 01:55:57.076131 (MainThread): Parsing macros\core.sql
2020-10-12 01:55:57.080159 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:55:57.135007 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:55:57.145982 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:55:57.146978 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:55:57.149971 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:55:57.151967 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:55:57.153963 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:55:57.154959 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:55:57.164933 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:55:57.182879 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:55:57.184874 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:55:57.193816 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:55:57.216756 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:55:57.252658 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:55:57.254653 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:55:57.274600 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:55:57.282617 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:55:57.288597 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:55:57.296584 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:55:57.298582 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:55:57.299576 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:55:57.300569 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:55:57.302565 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:55:57.323507 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:55:57.329494 (MainThread): Parsing macros\etc.sql
2020-10-12 01:55:57.330494 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:55:57.345451 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:55:57.347447 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:55:57.349439 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:55:57.361368 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:55:57.388295 (MainThread): Partial parsing not enabled
2020-10-12 01:55:57.429227 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:55:57.429227 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:55:57.454119 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:55:57.454119 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.464093 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:55:57.464093 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.472071 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:55:57.472071 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.482045 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:55:57.482045 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.490023 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:55:57.490023 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.598771 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:55:57.652589 (MainThread): Found 6 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:55:57.654593 (MainThread): 
2020-10-12 01:55:57.655630 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:55:57.655630 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:57.668549 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:55:57.668549 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:55:58.063724 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:55:58.064720 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:55:58.064720 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:55:58.381871 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:55:58.381871 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:55:58.381871 (MainThread): 21:55:58 | Concurrency: 1 threads (target='dev')
2020-10-12 01:55:58.382870 (MainThread): 21:55:58 | 
2020-10-12 01:55:58.387856 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:55:58.389849 (Thread-1): 21:55:58 | 1 of 6 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:55:58.401818 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:55:58.401818 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:55:58.402850 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:55:58.428749 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:55:58.429742 (Thread-1): finished collecting timing info
2020-10-12 01:55:58.488585 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:55:58.490579 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:55:59.714366 (Thread-1): finished collecting timing info
2020-10-12 01:55:59.715362 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0657A3D0>]}
2020-10-12 01:55:59.716359 (Thread-1): 21:55:59 | 1 of 6 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 1.31s]
2020-10-12 01:55:59.718356 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:55:59.718356 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:55:59.720349 (Thread-1): 21:55:59 | 2 of 6 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:55:59.723341 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:55:59.724340 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:55:59.724340 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:55:59.733314 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:55:59.734312 (Thread-1): finished collecting timing info
2020-10-12 01:55:59.741293 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:55:59.742290 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:56:00.405035 (Thread-1): finished collecting timing info
2020-10-12 01:56:00.406061 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0654D448>]}
2020-10-12 01:56:00.407030 (Thread-1): 21:56:00 | 2 of 6 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.68s]
2020-10-12 01:56:00.408027 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:56:00.408027 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:56:00.409025 (Thread-1): 21:56:00 | 3 of 6 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:56:00.411021 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:56:00.411021 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:56:00.411021 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:56:00.421992 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:56:00.422987 (Thread-1): finished collecting timing info
2020-10-12 01:56:00.430967 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:56:00.431964 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as with devices as (
    select * from `fa--interview-task.interview.devices`
),

renamed as (
    select row,
           type,
           device,
           cast(created_at as timestamp) as created_at,
           cast(updated_at as timestamp) as updated_at,
           type_id
    from devices
)

select * from renamed;


2020-10-12 01:56:00.892365 (Thread-1): finished collecting timing info
2020-10-12 01:56:00.892365 (Thread-1): Database Error in model devices (models\base\devices.sql)
  Unrecognized name: `row` at [11:12]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/c7536121-c538-4085-bd02-c68f888a332d?maxResults=0&location=US: Unrecognized name: `row` at [11:12]

(job ID: c7536121-c538-4085-bd02-c68f888a332d)

                                                      -----Query Job SQL Follows-----                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
   5:  OPTIONS()
   6:  as with devices as (
   7:    select * from `fa--interview-task.interview.devices`
   8:),
   9:
  10:renamed as (
  11:    select row,
  12:           type,
  13:           device,
  14:           cast(created_at as timestamp) as created_at,
  15:           cast(updated_at as timestamp) as updated_at,
  16:           type_id
  17:    from devices
  18:)
  19:
  20:select * from renamed;
  21:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model devices (models\base\devices.sql)
  Unrecognized name: `row` at [11:12]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:56:00.900333 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065B2190>]}
2020-10-12 01:56:00.901331 (Thread-1): 21:56:00 | 3 of 6 ERROR creating view model dbt_atambay.devices................. [ERROR in 0.49s]
2020-10-12 01:56:00.903059 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:56:00.903059 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:56:00.904056 (Thread-1): 21:56:00 | 4 of 6 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:56:00.905054 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:56:00.906052 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:56:00.906052 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:56:00.917022 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:56:00.918018 (Thread-1): finished collecting timing info
2020-10-12 01:56:00.923005 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:56:00.924004 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:56:01.893299 (Thread-1): finished collecting timing info
2020-10-12 01:56:01.894296 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067DBE20>]}
2020-10-12 01:56:01.895298 (Thread-1): 21:56:01 | 4 of 6 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.99s]
2020-10-12 01:56:01.896286 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:56:01.897251 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:56:01.898248 (Thread-1): 21:56:01 | 5 of 6 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:56:01.900576 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:56:01.900576 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:56:01.900576 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:56:01.905602 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:56:01.906605 (Thread-1): finished collecting timing info
2020-10-12 01:56:01.909599 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:56:01.910594 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:56:02.635059 (Thread-1): finished collecting timing info
2020-10-12 01:56:02.636056 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065C9118>]}
2020-10-12 01:56:02.637053 (Thread-1): 21:56:02 | 5 of 6 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.74s]
2020-10-12 01:56:02.637684 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:56:02.638685 (Thread-1): Began running node model.jaffle_shop.first_orders
2020-10-12 01:56:02.638685 (Thread-1): 21:56:02 | 6 of 6 START view model dbt_atambay.first_orders..................... [RUN]
2020-10-12 01:56:02.639727 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:56:02.640678 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 01:56:02.640678 (Thread-1): Compiling model.jaffle_shop.first_orders
2020-10-12 01:56:02.650652 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:56:02.651653 (Thread-1): finished collecting timing info
2020-10-12 01:56:02.655639 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:56:02.656637 (Thread-1): On model.jaffle_shop.first_orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_orders`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 01:56:03.322484 (Thread-1): finished collecting timing info
2020-10-12 01:56:03.323486 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60eca575-e440-4373-bd15-c96d9b61ac94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067DBE20>]}
2020-10-12 01:56:03.324485 (Thread-1): 21:56:03 | 6 of 6 OK created view model dbt_atambay.first_orders................ [CREATE VIEW in 0.68s]
2020-10-12 01:56:03.326445 (Thread-1): Finished running node model.jaffle_shop.first_orders
2020-10-12 01:56:03.327443 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:56:03.327443 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:03.327443 (MainThread): 21:56:03 | 
2020-10-12 01:56:03.328491 (MainThread): 21:56:03 | Finished running 6 view models in 5.67s.
2020-10-12 01:56:03.330511 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:56:03.330511 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:56:03.331538 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:56:03.331538 (MainThread): Connection 'model.jaffle_shop.first_orders' was left open.
2020-10-12 01:56:03.351489 (MainThread): 
2020-10-12 01:56:03.352633 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 01:56:03.353565 (MainThread): 
2020-10-12 01:56:03.354588 (MainThread): Database Error in model devices (models\base\devices.sql)
2020-10-12 01:56:03.356578 (MainThread):   Unrecognized name: `row` at [11:12]
2020-10-12 01:56:03.357557 (MainThread):   compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:56:03.358564 (MainThread): 
Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2020-10-12 01:56:03.359573 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0655F220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0660F658>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0660F1D8>]}
2020-10-12 01:56:03.359573 (MainThread): Flushing usage events
2020-10-12 01:56:52.240099 (MainThread): Running with dbt=0.17.0
2020-10-12 01:56:52.599141 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:56:52.599141 (MainThread): Tracking: tracking
2020-10-12 01:56:52.600139 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x050C1FE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05D4C2B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05D4C3B8>]}
2020-10-12 01:56:52.625070 (MainThread): Partial parsing not enabled
2020-10-12 01:56:52.628062 (MainThread): Parsing macros\core.sql
2020-10-12 01:56:52.635045 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:56:52.705854 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:56:52.718819 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:56:52.719818 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:56:52.721811 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:56:52.723806 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:56:52.727795 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:56:52.728792 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:56:52.738765 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:56:52.754757 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:56:52.757716 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:56:52.768762 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:56:52.792689 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:56:52.824606 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:56:52.826605 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:56:52.847475 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:56:52.854497 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:56:52.859481 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:56:52.869417 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:56:52.871412 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:56:52.872410 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:56:52.874404 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:56:52.876399 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:56:52.896344 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:56:52.903325 (MainThread): Parsing macros\etc.sql
2020-10-12 01:56:52.904322 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:56:52.920280 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:56:52.923272 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:56:52.925267 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:56:52.937234 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:56:52.961171 (MainThread): Partial parsing not enabled
2020-10-12 01:56:53.001102 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:56:53.001102 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:56:53.032021 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:56:53.032021 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.041990 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:56:53.043000 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.053924 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:56:53.053924 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.064893 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:56:53.064893 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.072912 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:56:53.073908 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.180584 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:56:53.228492 (MainThread): Found 6 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:56:53.229453 (MainThread): 
2020-10-12 01:56:53.231450 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:56:53.231450 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.242420 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:56:53.242420 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:56:53.561438 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:56:53.562407 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:56:53.562407 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:56:53.873575 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:56:53.873575 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:53.873575 (MainThread): 21:56:53 | Concurrency: 1 threads (target='dev')
2020-10-12 01:56:53.874571 (MainThread): 21:56:53 | 
2020-10-12 01:56:53.880557 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:56:53.882550 (Thread-1): 21:56:53 | 1 of 6 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:56:53.892523 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:56:53.892523 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:56:53.892523 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:56:53.920449 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:56:53.921446 (Thread-1): finished collecting timing info
2020-10-12 01:56:53.980288 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:56:53.981288 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:56:55.293837 (Thread-1): finished collecting timing info
2020-10-12 01:56:55.294868 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBDAD8>]}
2020-10-12 01:56:55.296855 (Thread-1): 21:56:55 | 1 of 6 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 1.40s]
2020-10-12 01:56:55.297825 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:56:55.297825 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:56:55.300847 (Thread-1): 21:56:55 | 2 of 6 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:56:55.302817 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:56:55.302817 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:56:55.302817 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:56:55.312786 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:56:55.313784 (Thread-1): finished collecting timing info
2020-10-12 01:56:55.321762 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:56:55.322758 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:56:56.154183 (Thread-1): finished collecting timing info
2020-10-12 01:56:56.155235 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E67B50>]}
2020-10-12 01:56:56.156234 (Thread-1): 21:56:56 | 2 of 6 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.85s]
2020-10-12 01:56:56.158174 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:56:56.158174 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:56:56.160199 (Thread-1): 21:56:56 | 3 of 6 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:56:56.160788 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:56:56.160788 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:56:56.160788 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:56:56.167772 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:56:56.168768 (Thread-1): finished collecting timing info
2020-10-12 01:56:56.172758 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:56:56.173755 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as with devices as (
    select * from `fa--interview-task.interview.devices`
),

renamed as (
    select Row as row,
           type,
           device,
           cast(created_at as timestamp) as created_at,
           cast(updated_at as timestamp) as updated_at,
           type_id
    from devices
)

select * from renamed;


2020-10-12 01:56:56.662741 (Thread-1): finished collecting timing info
2020-10-12 01:56:56.663738 (Thread-1): Database Error in model devices (models\base\devices.sql)
  Unrecognized name: `Row` at [11:12]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/0cde5fae-74b4-404f-bd7f-a4fe717ef17c?maxResults=0&location=US: Unrecognized name: `Row` at [11:12]

(job ID: 0cde5fae-74b4-404f-bd7f-a4fe717ef17c)

                                                      -----Query Job SQL Follows-----                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
   5:  OPTIONS()
   6:  as with devices as (
   7:    select * from `fa--interview-task.interview.devices`
   8:),
   9:
  10:renamed as (
  11:    select Row as row,
  12:           type,
  13:           device,
  14:           cast(created_at as timestamp) as created_at,
  15:           cast(updated_at as timestamp) as updated_at,
  16:           type_id
  17:    from devices
  18:)
  19:
  20:select * from renamed;
  21:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model devices (models\base\devices.sql)
  Unrecognized name: `Row` at [11:12]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:56:56.668727 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05EBDAD8>]}
2020-10-12 01:56:56.670722 (Thread-1): 21:56:56 | 3 of 6 ERROR creating view model dbt_atambay.devices................. [ERROR in 0.51s]
2020-10-12 01:56:56.671717 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:56:56.671717 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:56:56.672715 (Thread-1): 21:56:56 | 4 of 6 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:56:56.673720 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:56:56.673720 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:56:56.673720 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:56:56.680694 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:56:56.681692 (Thread-1): finished collecting timing info
2020-10-12 01:56:56.688673 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:56:56.689672 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:56:57.299053 (Thread-1): finished collecting timing info
2020-10-12 01:56:57.300093 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x060EAE50>]}
2020-10-12 01:56:57.301046 (Thread-1): 21:56:57 | 4 of 6 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.63s]
2020-10-12 01:56:57.302044 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:56:57.303043 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:56:57.304040 (Thread-1): 21:56:57 | 5 of 6 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:56:57.306046 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:56:57.307034 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:56:57.307034 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:56:57.314012 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:56:57.315009 (Thread-1): finished collecting timing info
2020-10-12 01:56:57.320001 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:56:57.321010 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:56:57.991062 (Thread-1): finished collecting timing info
2020-10-12 01:56:57.991062 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05ED9D78>]}
2020-10-12 01:56:57.992059 (Thread-1): 21:56:57 | 5 of 6 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.69s]
2020-10-12 01:56:57.993306 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:56:57.994313 (Thread-1): Began running node model.jaffle_shop.first_orders
2020-10-12 01:56:57.994313 (Thread-1): 21:56:57 | 6 of 6 START view model dbt_atambay.first_orders..................... [RUN]
2020-10-12 01:56:57.995784 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:56:57.995784 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 01:56:57.995784 (Thread-1): Compiling model.jaffle_shop.first_orders
2020-10-12 01:56:58.006757 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:56:58.007761 (Thread-1): finished collecting timing info
2020-10-12 01:56:58.010770 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:56:58.011743 (Thread-1): On model.jaffle_shop.first_orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_orders`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 01:56:58.592360 (Thread-1): finished collecting timing info
2020-10-12 01:56:58.592360 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a969c668-b80e-430f-b210-8fc731523ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E6A4D8>]}
2020-10-12 01:56:58.593357 (Thread-1): 21:56:58 | 6 of 6 OK created view model dbt_atambay.first_orders................ [CREATE VIEW in 0.60s]
2020-10-12 01:56:58.594579 (Thread-1): Finished running node model.jaffle_shop.first_orders
2020-10-12 01:56:58.596585 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:56:58.596585 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:56:58.596585 (MainThread): 21:56:58 | 
2020-10-12 01:56:58.597586 (MainThread): 21:56:58 | Finished running 6 view models in 5.37s.
2020-10-12 01:56:58.599376 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:56:58.599376 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:56:58.599376 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:56:58.600377 (MainThread): Connection 'model.jaffle_shop.first_orders' was left open.
2020-10-12 01:56:58.618329 (MainThread): 
2020-10-12 01:56:58.619328 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 01:56:58.631602 (MainThread): 
2020-10-12 01:56:58.632611 (MainThread): Database Error in model devices (models\base\devices.sql)
2020-10-12 01:56:58.634598 (MainThread):   Unrecognized name: `Row` at [11:12]
2020-10-12 01:56:58.635595 (MainThread):   compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:56:58.649273 (MainThread): 
Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2020-10-12 01:56:58.651274 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05ED9D78>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05F25310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05F25280>]}
2020-10-12 01:56:58.651274 (MainThread): Flushing usage events
2020-10-12 01:57:41.522686 (MainThread): Running with dbt=0.17.0
2020-10-12 01:57:41.868896 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:57:41.868896 (MainThread): Tracking: tracking
2020-10-12 01:57:41.869861 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x04D51F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x059E22C8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x059E2400>]}
2020-10-12 01:57:41.892835 (MainThread): Partial parsing not enabled
2020-10-12 01:57:41.896790 (MainThread): Parsing macros\core.sql
2020-10-12 01:57:41.901776 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:57:41.980564 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:57:41.991534 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:57:41.992532 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:57:41.994526 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:57:41.997519 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:57:41.999513 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:57:42.001508 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:57:42.009486 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:57:42.026515 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:57:42.029435 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:57:42.037490 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:57:42.062347 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:57:42.095329 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:57:42.098250 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:57:42.117227 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:57:42.124221 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:57:42.131161 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:57:42.138142 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:57:42.140138 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:57:42.141134 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:57:42.142132 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:57:42.144156 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:57:42.164075 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:57:42.173050 (MainThread): Parsing macros\etc.sql
2020-10-12 01:57:42.173050 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:57:42.190003 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:57:42.192997 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:57:42.196008 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:57:42.207957 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:57:42.236890 (MainThread): Partial parsing not enabled
2020-10-12 01:57:42.286745 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:57:42.286745 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:57:42.327637 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:57:42.327637 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.338642 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:57:42.339640 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.350576 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:57:42.350576 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.361546 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:57:42.361546 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.371518 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:57:42.371518 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.495229 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:57:42.543061 (MainThread): Found 6 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:57:42.544064 (MainThread): 
2020-10-12 01:57:42.545072 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:57:42.545072 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:42.568037 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:57:42.568037 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:57:43.004021 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:57:43.005019 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:57:43.005019 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:57:43.328156 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:57:43.329152 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:43.329152 (MainThread): 21:57:43 | Concurrency: 1 threads (target='dev')
2020-10-12 01:57:43.329152 (MainThread): 21:57:43 | 
2020-10-12 01:57:43.335136 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:57:43.337130 (Thread-1): 21:57:43 | 1 of 6 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:57:43.347105 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:57:43.347105 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:57:43.348105 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:57:43.377049 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:57:43.378021 (Thread-1): finished collecting timing info
2020-10-12 01:57:43.429883 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:57:43.430881 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:57:44.465924 (Thread-1): finished collecting timing info
2020-10-12 01:57:44.466921 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B4EB68>]}
2020-10-12 01:57:44.467918 (Thread-1): 21:57:44 | 1 of 6 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 1.12s]
2020-10-12 01:57:44.469915 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:57:44.469915 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:57:44.471909 (Thread-1): 21:57:44 | 2 of 6 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:57:44.473902 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:57:44.474900 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:57:44.474900 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:57:44.485870 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:57:44.486869 (Thread-1): finished collecting timing info
2020-10-12 01:57:44.492851 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:57:44.493849 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:57:45.374958 (Thread-1): finished collecting timing info
2020-10-12 01:57:45.375956 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B6DE80>]}
2020-10-12 01:57:45.377979 (Thread-1): 21:57:45 | 2 of 6 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.90s]
2020-10-12 01:57:45.379946 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:57:45.379946 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:57:45.381938 (Thread-1): 21:57:45 | 3 of 6 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:57:45.382936 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:57:45.382936 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:57:45.383947 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:57:45.392911 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:57:45.392911 (Thread-1): finished collecting timing info
2020-10-12 01:57:45.397896 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:57:45.398893 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as with devices as (
    select * from `fa--interview-task.interview.devices`
),

renamed as (
    select type,
           device,
           cast(created_at as timestamp) as created_at,
           cast(updated_at as timestamp) as updated_at,
           type_id
    from devices
)

select * from renamed;


2020-10-12 01:57:45.872679 (Thread-1): finished collecting timing info
2020-10-12 01:57:45.872679 (Thread-1): Database Error in model devices (models\base\devices.sql)
  Invalid cast from FLOAT64 to TIMESTAMP at [13:17]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/042954e5-706a-48dc-aa34-02dedce0d63d?maxResults=0&location=US: Invalid cast from FLOAT64 to TIMESTAMP at [13:17]

(job ID: 042954e5-706a-48dc-aa34-02dedce0d63d)

                                                      -----Query Job SQL Follows-----                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
   5:  OPTIONS()
   6:  as with devices as (
   7:    select * from `fa--interview-task.interview.devices`
   8:),
   9:
  10:renamed as (
  11:    select type,
  12:           device,
  13:           cast(created_at as timestamp) as created_at,
  14:           cast(updated_at as timestamp) as updated_at,
  15:           type_id
  16:    from devices
  17:)
  18:
  19:select * from renamed;
  20:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model devices (models\base\devices.sql)
  Invalid cast from FLOAT64 to TIMESTAMP at [13:17]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:57:45.879658 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BBA628>]}
2020-10-12 01:57:45.880689 (Thread-1): 21:57:45 | 3 of 6 ERROR creating view model dbt_atambay.devices................. [ERROR in 0.50s]
2020-10-12 01:57:45.882616 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:57:45.882616 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:57:45.884691 (Thread-1): 21:57:45 | 4 of 6 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:57:45.885607 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:57:45.885607 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:57:45.885607 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:57:45.890594 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:57:45.891591 (Thread-1): finished collecting timing info
2020-10-12 01:57:45.895580 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:57:45.896578 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:57:46.498195 (Thread-1): finished collecting timing info
2020-10-12 01:57:46.498195 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05C4B100>]}
2020-10-12 01:57:46.500151 (Thread-1): 21:57:46 | 4 of 6 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.61s]
2020-10-12 01:57:46.501151 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:57:46.501151 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:57:46.503145 (Thread-1): 21:57:46 | 5 of 6 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:57:46.505726 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:57:46.505726 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:57:46.505726 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:57:46.512698 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:57:46.512698 (Thread-1): finished collecting timing info
2020-10-12 01:57:46.518689 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:57:46.519691 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:57:47.340381 (Thread-1): finished collecting timing info
2020-10-12 01:57:47.340381 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05D6F0A0>]}
2020-10-12 01:57:47.341373 (Thread-1): 21:57:47 | 5 of 6 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.84s]
2020-10-12 01:57:47.343328 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:57:47.343328 (Thread-1): Began running node model.jaffle_shop.first_orders
2020-10-12 01:57:47.344326 (Thread-1): 21:57:47 | 6 of 6 START view model dbt_atambay.first_orders..................... [RUN]
2020-10-12 01:57:47.345322 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:57:47.345322 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 01:57:47.345322 (Thread-1): Compiling model.jaffle_shop.first_orders
2020-10-12 01:57:47.357359 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:57:47.358352 (Thread-1): finished collecting timing info
2020-10-12 01:57:47.364342 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:57:47.365299 (Thread-1): On model.jaffle_shop.first_orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_orders`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 01:57:47.989499 (Thread-1): finished collecting timing info
2020-10-12 01:57:47.989499 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac05d63e-cd75-4391-b759-824f636b3bd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05D6FBF8>]}
2020-10-12 01:57:47.990496 (Thread-1): 21:57:47 | 6 of 6 OK created view model dbt_atambay.first_orders................ [CREATE VIEW in 0.64s]
2020-10-12 01:57:47.992513 (Thread-1): Finished running node model.jaffle_shop.first_orders
2020-10-12 01:57:47.994508 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:57:47.994508 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:57:47.994508 (MainThread): 21:57:47 | 
2020-10-12 01:57:47.995495 (MainThread): 21:57:47 | Finished running 6 view models in 5.45s.
2020-10-12 01:57:47.995495 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:57:47.995495 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:57:47.996494 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:57:47.996494 (MainThread): Connection 'model.jaffle_shop.first_orders' was left open.
2020-10-12 01:57:48.017438 (MainThread): 
2020-10-12 01:57:48.017438 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 01:57:48.030199 (MainThread): 
2020-10-12 01:57:48.031201 (MainThread): Database Error in model devices (models\base\devices.sql)
2020-10-12 01:57:48.033194 (MainThread):   Invalid cast from FLOAT64 to TIMESTAMP at [13:17]
2020-10-12 01:57:48.034194 (MainThread):   compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:57:48.035190 (MainThread): 
Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2020-10-12 01:57:48.049151 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BB6EE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BB6FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BB6508>]}
2020-10-12 01:57:48.050149 (MainThread): Flushing usage events
2020-10-12 01:58:28.067006 (MainThread): Running with dbt=0.17.0
2020-10-12 01:58:28.420041 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 01:58:28.421044 (MainThread): Tracking: tracking
2020-10-12 01:58:28.421044 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0581CDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064B2370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064B22B0>]}
2020-10-12 01:58:28.443980 (MainThread): Partial parsing not enabled
2020-10-12 01:58:28.447979 (MainThread): Parsing macros\core.sql
2020-10-12 01:58:28.452959 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 01:58:28.514793 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 01:58:28.525696 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 01:58:28.526694 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 01:58:28.529755 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 01:58:28.531745 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 01:58:28.533739 (MainThread): Parsing macros\etc\query.sql
2020-10-12 01:58:28.535742 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 01:58:28.544646 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 01:58:28.566585 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 01:58:28.568580 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 01:58:28.576559 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 01:58:28.600494 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 01:58:28.631448 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 01:58:28.633446 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 01:58:28.654387 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 01:58:28.663363 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 01:58:28.670343 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 01:58:28.679285 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 01:58:28.681317 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 01:58:28.683308 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 01:58:28.684307 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 01:58:28.687298 (MainThread): Parsing macros\adapters.sql
2020-10-12 01:58:28.707211 (MainThread): Parsing macros\catalog.sql
2020-10-12 01:58:28.714190 (MainThread): Parsing macros\etc.sql
2020-10-12 01:58:28.715188 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 01:58:28.732217 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 01:58:28.735211 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 01:58:28.737208 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 01:58:28.750096 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 01:58:28.780016 (MainThread): Partial parsing not enabled
2020-10-12 01:58:28.826890 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:58:28.826890 (MainThread): Opening a new connection, currently in state init
2020-10-12 01:58:28.854884 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:58:28.854884 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:28.866848 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:58:28.866848 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:28.876758 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:58:28.877829 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:28.887793 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:58:28.887793 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:28.896784 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:58:28.897779 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:29.006446 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 01:58:29.049323 (MainThread): Found 6 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 01:58:29.055280 (MainThread): 
2020-10-12 01:58:29.055280 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:58:29.055280 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:29.073408 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 01:58:29.073408 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 01:58:29.411590 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 01:58:29.411590 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 01:58:29.411590 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 01:58:29.736722 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:58:29.736722 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:29.736722 (MainThread): 21:58:29 | Concurrency: 1 threads (target='dev')
2020-10-12 01:58:29.737719 (MainThread): 21:58:29 | 
2020-10-12 01:58:29.744700 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 01:58:29.745698 (Thread-1): 21:58:29 | 1 of 6 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 01:58:29.761654 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 01:58:29.761654 (Thread-1): Opening a new connection, currently in state init
2020-10-12 01:58:29.761654 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 01:58:29.787583 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 01:58:29.788581 (Thread-1): finished collecting timing info
2020-10-12 01:58:29.851414 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 01:58:29.854405 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 01:58:30.653706 (Thread-1): finished collecting timing info
2020-10-12 01:58:30.654704 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0661EB98>]}
2020-10-12 01:58:30.655673 (Thread-1): 21:58:30 | 1 of 6 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.89s]
2020-10-12 01:58:30.656670 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 01:58:30.656670 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 01:58:30.658664 (Thread-1): 21:58:30 | 2 of 6 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 01:58:30.660658 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 01:58:30.660658 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 01:58:30.660658 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 01:58:30.669673 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:58:30.669673 (Thread-1): finished collecting timing info
2020-10-12 01:58:30.675620 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 01:58:30.676616 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 01:58:31.329496 (Thread-1): finished collecting timing info
2020-10-12 01:58:31.330494 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06638EE0>]}
2020-10-12 01:58:31.332488 (Thread-1): 21:58:31 | 2 of 6 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.67s]
2020-10-12 01:58:31.333484 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 01:58:31.333484 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 01:58:31.335483 (Thread-1): 21:58:31 | 3 of 6 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 01:58:31.336475 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 01:58:31.336475 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 01:58:31.337475 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 01:58:31.345453 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 01:58:31.347446 (Thread-1): finished collecting timing info
2020-10-12 01:58:31.354428 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 01:58:31.355424 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as with devices as (
    select * from `fa--interview-task.interview.devices`
),

renamed as (
    select type,
           device,
           created_at::timestamp,
           updated_at::timestamp,
           type_id
    from devices
)

select * from renamed;


2020-10-12 01:58:31.513525 (Thread-1): finished collecting timing info
2020-10-12 01:58:31.514523 (Thread-1): Database Error in model devices (models\base\devices.sql)
  Syntax error: Expected ")" but got ":" at [13:22]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected ")" but got ":" at [13:22]

(job ID: bfd3350e-5f23-4fd7-9815-35a71b981a23)

                                                      -----Query Job SQL Follows-----                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
   5:  OPTIONS()
   6:  as with devices as (
   7:    select * from `fa--interview-task.interview.devices`
   8:),
   9:
  10:renamed as (
  11:    select type,
  12:           device,
  13:           created_at::timestamp,
  14:           updated_at::timestamp,
  15:           type_id
  16:    from devices
  17:)
  18:
  19:select * from renamed;
  20:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model devices (models\base\devices.sql)
  Syntax error: Expected ")" but got ":" at [13:22]
  compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:58:31.519510 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06688FE8>]}
2020-10-12 01:58:31.520507 (Thread-1): 21:58:31 | 3 of 6 ERROR creating view model dbt_atambay.devices................. [ERROR in 0.18s]
2020-10-12 01:58:31.521503 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 01:58:31.522511 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 01:58:31.523499 (Thread-1): 21:58:31 | 4 of 6 START view model dbt_atambay.main............................. [RUN]
2020-10-12 01:58:31.527490 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 01:58:31.527490 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 01:58:31.527490 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 01:58:31.537461 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 01:58:31.538458 (Thread-1): finished collecting timing info
2020-10-12 01:58:31.544441 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 01:58:31.545444 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 
    LEFT JOIN ( 
                SELECT 
                fo.user_id, 
                MIN(fo.order_id) as first_order_id 
                FROM `fa--interview-task.interview.orders` as fo 
                WHERE 
                fo.status != 'cancelled' 
                GROUP BY 
                fo.user_id 
    ) fo ON o.user_id = fo.user_id 
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 01:58:32.366521 (Thread-1): finished collecting timing info
2020-10-12 01:58:32.366521 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0684C0B8>]}
2020-10-12 01:58:32.367514 (Thread-1): 21:58:32 | 4 of 6 OK created view model dbt_atambay.main........................ [CREATE VIEW in 0.84s]
2020-10-12 01:58:32.369348 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 01:58:32.369348 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 01:58:32.370390 (Thread-1): 21:58:32 | 5 of 6 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 01:58:32.372918 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 01:58:32.372918 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 01:58:32.372918 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 01:58:32.381892 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 01:58:32.382917 (Thread-1): finished collecting timing info
2020-10-12 01:58:32.388916 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 01:58:32.388916 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 01:58:33.260208 (Thread-1): finished collecting timing info
2020-10-12 01:58:33.260208 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0671C5F8>]}
2020-10-12 01:58:33.261205 (Thread-1): 21:58:33 | 5 of 6 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.89s]
2020-10-12 01:58:33.262995 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 01:58:33.262995 (Thread-1): Began running node model.jaffle_shop.first_orders
2020-10-12 01:58:33.263994 (Thread-1): 21:58:33 | 6 of 6 START view model dbt_atambay.first_orders..................... [RUN]
2020-10-12 01:58:33.264955 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_orders".
2020-10-12 01:58:33.264955 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 01:58:33.264955 (Thread-1): Compiling model.jaffle_shop.first_orders
2020-10-12 01:58:33.271977 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:58:33.272971 (Thread-1): finished collecting timing info
2020-10-12 01:58:33.275965 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_orders"
2020-10-12 01:58:33.276959 (Thread-1): On model.jaffle_shop.first_orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_orders`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 01:58:33.916083 (Thread-1): finished collecting timing info
2020-10-12 01:58:33.917080 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31bdf210-073a-437c-a02e-d455eeccf666', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0684A6B8>]}
2020-10-12 01:58:33.918077 (Thread-1): 21:58:33 | 6 of 6 OK created view model dbt_atambay.first_orders................ [CREATE VIEW in 0.65s]
2020-10-12 01:58:33.920070 (Thread-1): Finished running node model.jaffle_shop.first_orders
2020-10-12 01:58:33.921071 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 01:58:33.921071 (MainThread): Opening a new connection, currently in state closed
2020-10-12 01:58:33.921071 (MainThread): 21:58:33 | 
2020-10-12 01:58:33.923062 (MainThread): 21:58:33 | Finished running 6 view models in 4.87s.
2020-10-12 01:58:33.924061 (MainThread): Connection 'master' was properly closed.
2020-10-12 01:58:33.924061 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 01:58:33.924061 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 01:58:33.924061 (MainThread): Connection 'model.jaffle_shop.first_orders' was left open.
2020-10-12 01:58:33.942013 (MainThread): 
2020-10-12 01:58:33.943011 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 01:58:33.944008 (MainThread): 
2020-10-12 01:58:33.945004 (MainThread): Database Error in model devices (models\base\devices.sql)
2020-10-12 01:58:33.946003 (MainThread):   Syntax error: Expected ")" but got ":" at [13:22]
2020-10-12 01:58:33.947039 (MainThread):   compiled SQL at target\run\jaffle_shop\models\base\devices.sql
2020-10-12 01:58:33.959978 (MainThread): 
Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2020-10-12 01:58:33.960962 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06684250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x066846B8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0667ED78>]}
2020-10-12 01:58:33.960962 (MainThread): Flushing usage events
2020-10-12 03:08:17.797540 (MainThread): Running with dbt=0.17.0
2020-10-12 03:08:18.320010 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 03:08:18.322971 (MainThread): Tracking: tracking
2020-10-12 03:08:18.322971 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05801FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06493340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06493280>]}
2020-10-12 03:08:18.346564 (MainThread): Partial parsing not enabled
2020-10-12 03:08:18.353438 (MainThread): Parsing macros\core.sql
2020-10-12 03:08:18.358446 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 03:08:18.415512 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 03:08:18.425488 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 03:08:18.427501 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 03:08:18.431055 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 03:08:18.433051 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 03:08:18.435045 (MainThread): Parsing macros\etc\query.sql
2020-10-12 03:08:18.437197 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 03:08:18.447181 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 03:08:18.466122 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 03:08:18.469115 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 03:08:18.478089 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 03:08:18.503520 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 03:08:18.534267 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 03:08:18.537260 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 03:08:18.556215 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 03:08:18.565185 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 03:08:18.571169 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 03:08:18.579160 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 03:08:18.581142 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 03:08:18.582139 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 03:08:18.583137 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 03:08:18.586365 (MainThread): Parsing macros\adapters.sql
2020-10-12 03:08:18.605342 (MainThread): Parsing macros\catalog.sql
2020-10-12 03:08:18.612300 (MainThread): Parsing macros\etc.sql
2020-10-12 03:08:18.615295 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 03:08:18.642282 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 03:08:18.645253 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 03:08:18.648207 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 03:08:18.659173 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 03:08:18.683185 (MainThread): Partial parsing not enabled
2020-10-12 03:08:18.722042 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 03:08:18.722042 (MainThread): Opening a new connection, currently in state init
2020-10-12 03:08:18.752921 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:08:18.752921 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.762897 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:08:18.762897 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.772696 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:08:18.772696 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.782711 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:08:18.782711 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.790686 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:08:18.790686 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.802657 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:08:18.802657 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.913577 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 03:08:18.970426 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 03:08:18.972471 (MainThread): 
2020-10-12 03:08:18.973469 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:18.973469 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:18.989425 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 03:08:18.989425 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 03:08:19.374128 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 03:08:19.374128 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 03:08:19.375124 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 03:08:19.735697 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:19.736692 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:19.736692 (MainThread): 23:08:19 | Concurrency: 1 threads (target='dev')
2020-10-12 03:08:19.737689 (MainThread): 23:08:19 | 
2020-10-12 03:08:19.744671 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 03:08:19.746666 (Thread-1): 23:08:19 | 1 of 7 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 03:08:19.758635 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:08:19.758635 (Thread-1): Opening a new connection, currently in state init
2020-10-12 03:08:19.758635 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 03:08:19.787556 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 03:08:19.788554 (Thread-1): finished collecting timing info
2020-10-12 03:08:19.842409 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 03:08:19.843409 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-12 03:08:20.894263 (Thread-1): finished collecting timing info
2020-10-12 03:08:20.895260 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0662B0A0>]}
2020-10-12 03:08:20.897257 (Thread-1): 23:08:20 | 1 of 7 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.14s]
2020-10-12 03:08:20.898253 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 03:08:20.898253 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 03:08:20.901243 (Thread-1): 23:08:20 | 2 of 7 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 03:08:20.903239 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:08:20.903239 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 03:08:20.903239 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 03:08:20.916237 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 03:08:20.917201 (Thread-1): finished collecting timing info
2020-10-12 03:08:20.924183 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 03:08:20.928172 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 03:08:21.550568 (Thread-1): finished collecting timing info
2020-10-12 03:08:21.551601 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064930B8>]}
2020-10-12 03:08:21.553560 (Thread-1): 23:08:21 | 2 of 7 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.65s]
2020-10-12 03:08:21.554557 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 03:08:21.554557 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 03:08:21.556594 (Thread-1): 23:08:21 | 3 of 7 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 03:08:21.559546 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:08:21.559546 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 03:08:21.559546 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 03:08:21.571541 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:08:21.572510 (Thread-1): finished collecting timing info
2020-10-12 03:08:21.585402 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:08:21.589274 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 03:08:22.425747 (Thread-1): finished collecting timing info
2020-10-12 03:08:22.426781 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06645058>]}
2020-10-12 03:08:22.427776 (Thread-1): 23:08:22 | 3 of 7 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.87s]
2020-10-12 03:08:22.429736 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 03:08:22.429736 (Thread-1): Began running node model.jaffle_shop.main
2020-10-12 03:08:22.430733 (Thread-1): 23:08:22 | 4 of 7 START view model dbt_atambay.main............................. [RUN]
2020-10-12 03:08:22.432728 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 03:08:22.432728 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 03:08:22.432728 (Thread-1): Compiling model.jaffle_shop.main
2020-10-12 03:08:22.438746 (Thread-1): Writing injected SQL for node "model.jaffle_shop.main"
2020-10-12 03:08:22.442188 (Thread-1): finished collecting timing info
2020-10-12 03:08:22.447177 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.main"
2020-10-12 03:08:22.449174 (Thread-1): On model.jaffle_shop.main: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
  OPTIONS()
  as SELECT 
*, 
amount_total_cents / 100 as amount_total, 
gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
gross_shipping_amount_cents/ 100 as gross_shipping_amount 
FROM ( 
    SELECT 
    o.order_id, 
    o.user_id, 
    o.created_at, 
    o.updated_at, 
    o.shipped_at, 
    o.currency, 
    o.status AS order_status, 
    CASE 
    WHEN o.status IN ( 
    'paid', 
    'completed', 
    'shipped' 
    ) THEN 'completed' 
    ELSE o.status 
    END AS order_status_category, 
    CASE 
    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
    o.shipping_method, 
    CASE 
    WHEN d.device = 'web' THEN 'desktop' 
    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
    END AS purchase_device_type, 
    d.device AS purchase_device, 
    CASE 
    WHEN fo.first_order_id = o.order_id THEN 'new' 
    ELSE 'repeat' 
    END AS user_type,
    o.amount_total_cents, 
    pa.gross_total_amount_cents, 
    CASE 
    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
    END AS total_amount_cents, 
    pa.gross_tax_amount_cents, 
    pa.gross_amount_cents, 
    pa.gross_shipping_amount_cents 
    FROM `fa--interview-task.interview.orders` o 
    LEFT JOIN ( 
                SELECT 
                DISTINCT cast(d.type_id as int64) as order_id, 
                FIRST_VALUE(d.device) OVER ( 
                PARTITION BY d.type_id 
                ORDER BY 
                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                ) AS device 
                FROM `fa--interview-task.interview.devices` d 
                WHERE d.type = 'order' 
    ) d ON d.order_id = o.order_id 

    LEFT JOIN (first_orders) fo ON o.user_id = fo.user_id 
    
    left join `fa--interview-task.interview.addresses` oa 
    ON oa.order_id = o.order_id 
    LEFT JOIN ( 
                select 
                order_id, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
                END 
                ) as gross_tax_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
                END
                ) as gross_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
                END 
                ) as gross_shipping_amount_cents, 
                sum( 
                CASE 
                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
                END 
                ) as gross_total_amount_cents 
                FROM `fa--interview-task.interview.payments` 
                GROUP BY order_id 
    ) pa ON pa.order_id = o.order_id 
);


2020-10-12 03:08:22.638919 (Thread-1): finished collecting timing info
2020-10-12 03:08:22.639917 (Thread-1): Database Error in model main (models\main.sql)
  Syntax error: Expected keyword JOIN but got ")" at [63:28]
  compiled SQL at target\run\jaffle_shop\models\main.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected keyword JOIN but got ")" at [63:28]

(job ID: f20ed517-dc9d-4403-9b84-cda4ae807331)

                                                                               -----Query Job SQL Follows-----                                                                               

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.main"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`main`
   5:  OPTIONS()
   6:  as SELECT 
   7:*, 
   8:amount_total_cents / 100 as amount_total, 
   9:gross_total_amount_cents/ 100 as gross_total_amount, total_amount_cents/ 100 as total_amount, 
  10:gross_tax_amount_cents/ 100 as gross_tax_amount, gross_amount_cents/ 100 as gross_amount, 
  11:gross_shipping_amount_cents/ 100 as gross_shipping_amount 
  12:FROM ( 
  13:    SELECT 
  14:    o.order_id, 
  15:    o.user_id, 
  16:    o.created_at, 
  17:    o.updated_at, 
  18:    o.shipped_at, 
  19:    o.currency, 
  20:    o.status AS order_status, 
  21:    CASE 
  22:    WHEN o.status IN ( 
  23:    'paid', 
  24:    'completed', 
  25:    'shipped' 
  26:    ) THEN 'completed' 
  27:    ELSE o.status 
  28:    END AS order_status_category, 
  29:    CASE 
  30:    WHEN oa.country_code IS NULL THEN 'Null country' WHEN oa.country_code = 'US' THEN 'US' 
  31:    WHEN oa.country_code != 'US' THEN 'International' END AS country_type, 
  32:    o.shipping_method, 
  33:    CASE 
  34:    WHEN d.device = 'web' THEN 'desktop' 
  35:    WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' when d.device IN ('mobile', 'tablet') THEN 'mobile-web' when NULLIF(d.device, '') IS NULL THEN 'unknown' ELSE 'ERROR' 
  36:    END AS purchase_device_type, 
  37:    d.device AS purchase_device, 
  38:    CASE 
  39:    WHEN fo.first_order_id = o.order_id THEN 'new' 
  40:    ELSE 'repeat' 
  41:    END AS user_type,
  42:    o.amount_total_cents, 
  43:    pa.gross_total_amount_cents, 
  44:    CASE 
  45:    WHEN o.currency = 'USD' then o.amount_total_cents ELSE pa.gross_total_amount_cents 
  46:    END AS total_amount_cents, 
  47:    pa.gross_tax_amount_cents, 
  48:    pa.gross_amount_cents, 
  49:    pa.gross_shipping_amount_cents 
  50:    FROM `fa--interview-task.interview.orders` o 
  51:    LEFT JOIN ( 
  52:                SELECT 
  53:                DISTINCT cast(d.type_id as int64) as order_id, 
  54:                FIRST_VALUE(d.device) OVER ( 
  55:                PARTITION BY d.type_id 
  56:                ORDER BY 
  57:                d.created_at ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
  58:                ) AS device 
  59:                FROM `fa--interview-task.interview.devices` d 
  60:                WHERE d.type = 'order' 
  61:    ) d ON d.order_id = o.order_id 
  62:
  63:    LEFT JOIN (first_orders) fo ON o.user_id = fo.user_id 
  64:    
  65:    left join `fa--interview-task.interview.addresses` oa 
  66:    ON oa.order_id = o.order_id 
  67:    LEFT JOIN ( 
  68:                select 
  69:                order_id, 
  70:                sum( 
  71:                CASE 
  72:                WHEN status = 'completed' THEN tax_amount_cents ELSE 0 
  73:                END 
  74:                ) as gross_tax_amount_cents, 
  75:                sum( 
  76:                CASE 
  77:                WHEN status = 'completed' THEN amount_cents 
  78:                ELSE 0 
  79:                END
  80:                ) as gross_amount_cents, 
  81:                sum( 
  82:                CASE 
  83:                WHEN status = 'completed' THEN amount_shipping_cents 
  84:                ELSE 0 
  85:                END 
  86:                ) as gross_shipping_amount_cents, 
  87:                sum( 
  88:                CASE 
  89:                WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents ELSE 0 
  90:                END 
  91:                ) as gross_total_amount_cents 
  92:                FROM `fa--interview-task.interview.payments` 
  93:                GROUP BY order_id 
  94:    ) pa ON pa.order_id = o.order_id 
  95:);
  96:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model main (models\main.sql)
  Syntax error: Expected keyword JOIN but got ")" at [63:28]
  compiled SQL at target\run\jaffle_shop\models\main.sql
2020-10-12 03:08:22.654297 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065B1FE8>]}
2020-10-12 03:08:22.655296 (Thread-1): 23:08:22 | 4 of 7 ERROR creating view model dbt_atambay.main.................... [ERROR in 0.22s]
2020-10-12 03:08:22.656666 (Thread-1): Finished running node model.jaffle_shop.main
2020-10-12 03:08:22.656666 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 03:08:22.657691 (Thread-1): 23:08:22 | 5 of 7 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 03:08:22.659660 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:08:22.659660 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.main).
2020-10-12 03:08:22.659660 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 03:08:22.667638 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 03:08:22.669634 (Thread-1): finished collecting timing info
2020-10-12 03:08:22.675619 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 03:08:22.676615 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 03:08:23.510645 (Thread-1): finished collecting timing info
2020-10-12 03:08:23.510645 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0660F3A0>]}
2020-10-12 03:08:23.512635 (Thread-1): 23:08:23 | 5 of 7 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.85s]
2020-10-12 03:08:23.513598 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 03:08:23.513598 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-12 03:08:23.514596 (Thread-1): 23:08:23 | 6 of 7 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-12 03:08:23.517588 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:08:23.518584 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 03:08:23.518584 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-12 03:08:23.526564 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:08:23.527561 (Thread-1): finished collecting timing info
2020-10-12 03:08:23.533546 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:08:23.534543 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
)

select * from xf;


2020-10-12 03:08:24.412668 (Thread-1): finished collecting timing info
2020-10-12 03:08:24.413666 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065F6B08>]}
2020-10-12 03:08:24.414657 (Thread-1): 23:08:24 | 6 of 7 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.90s]
2020-10-12 03:08:24.415591 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-12 03:08:24.415591 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-12 03:08:24.417587 (Thread-1): 23:08:24 | 7 of 7 START view model dbt_atambay.first_order...................... [RUN]
2020-10-12 03:08:24.418583 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:08:24.418583 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-12 03:08:24.418583 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-12 03:08:24.425564 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:08:24.426570 (Thread-1): finished collecting timing info
2020-10-12 03:08:24.429590 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:08:24.431549 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 03:08:25.179742 (Thread-1): finished collecting timing info
2020-10-12 03:08:25.179742 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19220f64-26c5-4716-aa46-03f07da561f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065AF130>]}
2020-10-12 03:08:25.180655 (Thread-1): 23:08:25 | 7 of 7 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.76s]
2020-10-12 03:08:25.182619 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-12 03:08:25.183607 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:25.183607 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:25.184614 (MainThread): 23:08:25 | 
2020-10-12 03:08:25.186598 (MainThread): 23:08:25 | Finished running 7 view models in 6.21s.
2020-10-12 03:08:25.187597 (MainThread): Connection 'master' was properly closed.
2020-10-12 03:08:25.187597 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 03:08:25.187597 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 03:08:25.187597 (MainThread): Connection 'model.jaffle_shop.first_order' was left open.
2020-10-12 03:08:25.207568 (MainThread): 
2020-10-12 03:08:25.211441 (MainThread): Completed with 1 error and 0 warnings:
2020-10-12 03:08:25.212459 (MainThread): 
2020-10-12 03:08:25.213439 (MainThread): Database Error in model main (models\main.sql)
2020-10-12 03:08:25.214439 (MainThread):   Syntax error: Expected keyword JOIN but got ")" at [63:28]
2020-10-12 03:08:25.215434 (MainThread):   compiled SQL at target\run\jaffle_shop\models\main.sql
2020-10-12 03:08:25.230393 (MainThread): 
Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
2020-10-12 03:08:25.232388 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06600E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0660FC70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0660FC40>]}
2020-10-12 03:08:25.232388 (MainThread): Flushing usage events
2020-10-12 03:08:36.038497 (MainThread): Running with dbt=0.17.0
2020-10-12 03:08:36.402488 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 03:08:36.403489 (MainThread): Tracking: tracking
2020-10-12 03:08:36.403489 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05551FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x061E3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x061E3250>]}
2020-10-12 03:08:36.426425 (MainThread): Partial parsing not enabled
2020-10-12 03:08:36.430381 (MainThread): Parsing macros\core.sql
2020-10-12 03:08:36.435400 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 03:08:36.493467 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 03:08:36.506396 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 03:08:36.507393 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 03:08:36.509388 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 03:08:36.513377 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 03:08:36.515372 (MainThread): Parsing macros\etc\query.sql
2020-10-12 03:08:36.516369 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 03:08:36.527340 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 03:08:36.545703 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 03:08:36.547697 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 03:08:36.555714 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 03:08:36.581643 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 03:08:36.611538 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 03:08:36.613519 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 03:08:36.635462 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 03:08:36.646432 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 03:08:36.651418 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 03:08:36.659397 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 03:08:36.662389 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 03:08:36.663386 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 03:08:36.668622 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 03:08:36.670627 (MainThread): Parsing macros\adapters.sql
2020-10-12 03:08:36.694555 (MainThread): Parsing macros\catalog.sql
2020-10-12 03:08:36.704529 (MainThread): Parsing macros\etc.sql
2020-10-12 03:08:36.706524 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 03:08:36.726471 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 03:08:36.729462 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 03:08:36.732455 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 03:08:36.745912 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 03:08:36.770846 (MainThread): Partial parsing not enabled
2020-10-12 03:08:36.810738 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 03:08:36.811736 (MainThread): Opening a new connection, currently in state init
2020-10-12 03:08:36.840658 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:08:36.840658 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:36.851040 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:08:36.852036 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:36.861946 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:08:36.861946 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:36.872916 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:08:36.872916 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:36.882935 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:08:36.882935 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:36.893895 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:08:36.893895 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:37.004984 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 03:08:37.072263 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 03:08:37.073263 (MainThread): 
2020-10-12 03:08:37.074267 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:37.074267 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:37.099225 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 03:08:37.099225 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 03:08:37.420118 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 03:08:37.420118 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 03:08:37.421114 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 03:08:37.732412 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:37.732412 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:37.733409 (MainThread): 23:08:37 | Concurrency: 1 threads (target='dev')
2020-10-12 03:08:37.733409 (MainThread): 23:08:37 | 
2020-10-12 03:08:37.741387 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 03:08:37.743383 (Thread-1): 23:08:37 | 1 of 6 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 03:08:37.753356 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:08:37.753356 (Thread-1): Opening a new connection, currently in state init
2020-10-12 03:08:37.753356 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 03:08:37.783278 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 03:08:37.785275 (Thread-1): finished collecting timing info
2020-10-12 03:08:37.861181 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 03:08:37.864179 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-12 03:08:38.695320 (Thread-1): finished collecting timing info
2020-10-12 03:08:38.696315 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062DBE68>]}
2020-10-12 03:08:38.698312 (Thread-1): 23:08:38 | 1 of 6 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 0.94s]
2020-10-12 03:08:38.699309 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 03:08:38.700341 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 03:08:38.702301 (Thread-1): 23:08:38 | 2 of 6 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 03:08:38.705292 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:08:38.705292 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 03:08:38.705292 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 03:08:38.716263 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 03:08:38.717261 (Thread-1): finished collecting timing info
2020-10-12 03:08:38.725238 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 03:08:38.726235 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as select * from `fa--interview-task.interview.orders`;


2020-10-12 03:08:39.344380 (Thread-1): finished collecting timing info
2020-10-12 03:08:39.345376 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06301BF8>]}
2020-10-12 03:08:39.347372 (Thread-1): 23:08:39 | 2 of 6 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.64s]
2020-10-12 03:08:39.349366 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 03:08:39.349366 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 03:08:39.353355 (Thread-1): 23:08:39 | 3 of 6 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 03:08:39.355874 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:08:39.355874 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 03:08:39.355874 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 03:08:39.373792 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:08:39.375785 (Thread-1): finished collecting timing info
2020-10-12 03:08:39.389748 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:08:39.390746 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 03:08:39.991140 (Thread-1): finished collecting timing info
2020-10-12 03:08:39.992138 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062DD9D0>]}
2020-10-12 03:08:39.994131 (Thread-1): 23:08:39 | 3 of 6 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.64s]
2020-10-12 03:08:39.996126 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 03:08:39.996126 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 03:08:40.000117 (Thread-1): 23:08:39 | 4 of 6 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 03:08:40.002110 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:08:40.002110 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 03:08:40.002110 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 03:08:40.013081 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 03:08:40.015076 (Thread-1): finished collecting timing info
2020-10-12 03:08:40.027044 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 03:08:40.029038 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 03:08:40.706304 (Thread-1): finished collecting timing info
2020-10-12 03:08:40.707301 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06341F58>]}
2020-10-12 03:08:40.709296 (Thread-1): 23:08:40 | 4 of 6 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.71s]
2020-10-12 03:08:40.710293 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 03:08:40.711292 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-12 03:08:40.714283 (Thread-1): 23:08:40 | 5 of 6 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-12 03:08:40.716280 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:08:40.717275 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 03:08:40.717275 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-12 03:08:40.735227 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:08:40.737223 (Thread-1): finished collecting timing info
2020-10-12 03:08:40.752184 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:08:40.755177 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
)

select * from xf;


2020-10-12 03:08:41.486373 (Thread-1): finished collecting timing info
2020-10-12 03:08:41.487405 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062E2850>]}
2020-10-12 03:08:41.488405 (Thread-1): 23:08:41 | 5 of 6 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.77s]
2020-10-12 03:08:41.489263 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-12 03:08:41.490263 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-12 03:08:41.491294 (Thread-1): 23:08:41 | 6 of 6 START view model dbt_atambay.first_order...................... [RUN]
2020-10-12 03:08:41.493255 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:08:41.494252 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-12 03:08:41.494252 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-12 03:08:41.505262 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:08:41.506220 (Thread-1): finished collecting timing info
2020-10-12 03:08:41.512238 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:08:41.513236 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 03:08:42.065742 (Thread-1): finished collecting timing info
2020-10-12 03:08:42.067738 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22745d0-918b-43bc-a09e-f92f040e01fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062DD9D0>]}
2020-10-12 03:08:42.068759 (Thread-1): 23:08:42 | 6 of 6 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.57s]
2020-10-12 03:08:42.069737 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-12 03:08:42.071867 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:08:42.071867 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:08:42.071867 (MainThread): 23:08:42 | 
2020-10-12 03:08:42.073157 (MainThread): 23:08:42 | Finished running 6 view models in 5.00s.
2020-10-12 03:08:42.073157 (MainThread): Connection 'master' was properly closed.
2020-10-12 03:08:42.073157 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 03:08:42.073157 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 03:08:42.073157 (MainThread): Connection 'model.jaffle_shop.first_order' was left open.
2020-10-12 03:08:42.092109 (MainThread): 
2020-10-12 03:08:42.092109 (MainThread): Completed successfully
2020-10-12 03:08:42.094104 (MainThread): 
Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
2020-10-12 03:08:42.095101 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06350118>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06350FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06350F58>]}
2020-10-12 03:08:42.096099 (MainThread): Flushing usage events
2020-10-12 03:23:09.231326 (MainThread): Running with dbt=0.17.0
2020-10-12 03:23:09.615254 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-12 03:23:09.616219 (MainThread): Tracking: tracking
2020-10-12 03:23:09.616219 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BF1FE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x068823A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06882418>]}
2020-10-12 03:23:09.639157 (MainThread): Partial parsing not enabled
2020-10-12 03:23:09.643147 (MainThread): Parsing macros\core.sql
2020-10-12 03:23:09.648134 (MainThread): Parsing macros\adapters\common.sql
2020-10-12 03:23:09.710009 (MainThread): Parsing macros\etc\datetime.sql
2020-10-12 03:23:09.721971 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-12 03:23:09.722969 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-12 03:23:09.724966 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-12 03:23:09.727957 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-12 03:23:09.729950 (MainThread): Parsing macros\etc\query.sql
2020-10-12 03:23:09.730947 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-12 03:23:09.741922 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-12 03:23:09.759872 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-12 03:23:09.761870 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-12 03:23:09.771804 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-12 03:23:09.795773 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-12 03:23:09.829684 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-12 03:23:09.831680 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-12 03:23:09.853585 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-12 03:23:09.860602 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-12 03:23:09.867549 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-12 03:23:09.877521 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-12 03:23:09.879516 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-12 03:23:09.881511 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-12 03:23:09.882509 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-12 03:23:09.885500 (MainThread): Parsing macros\adapters.sql
2020-10-12 03:23:09.904448 (MainThread): Parsing macros\catalog.sql
2020-10-12 03:23:09.910469 (MainThread): Parsing macros\etc.sql
2020-10-12 03:23:09.911430 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-12 03:23:09.928418 (MainThread): Parsing macros\materializations\seed.sql
2020-10-12 03:23:09.930413 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-12 03:23:09.933371 (MainThread): Parsing macros\materializations\table.sql
2020-10-12 03:23:09.944341 (MainThread): Parsing macros\materializations\view.sql
2020-10-12 03:23:09.968315 (MainThread): Partial parsing not enabled
2020-10-12 03:23:10.011164 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-12 03:23:10.011164 (MainThread): Opening a new connection, currently in state init
2020-10-12 03:23:10.040128 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:23:10.040128 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.049098 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:23:10.049098 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.059069 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:23:10.059069 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.069044 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:23:10.070036 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.080012 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:23:10.081010 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.091993 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:23:10.092982 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.103915 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-12 03:23:10.104947 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.220167 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-12 03:23:10.278783 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-12 03:23:10.280751 (MainThread): 
2020-10-12 03:23:10.281729 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:23:10.281729 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:10.293698 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-12 03:23:10.294694 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-12 03:23:10.800764 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-12 03:23:10.801762 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-12 03:23:10.801762 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-12 03:23:11.340274 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:23:11.340274 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:11.341271 (MainThread): 23:23:11 | Concurrency: 1 threads (target='dev')
2020-10-12 03:23:11.341271 (MainThread): 23:23:11 | 
2020-10-12 03:23:11.347256 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-12 03:23:11.349250 (Thread-1): 23:23:11 | 1 of 7 START view model dbt_atambay.devices.......................... [RUN]
2020-10-12 03:23:11.362216 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-12 03:23:11.362216 (Thread-1): Opening a new connection, currently in state init
2020-10-12 03:23:11.362216 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-12 03:23:11.388154 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-12 03:23:11.389145 (Thread-1): finished collecting timing info
2020-10-12 03:23:11.444996 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-12 03:23:11.445992 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-12 03:23:12.938417 (Thread-1): finished collecting timing info
2020-10-12 03:23:12.939415 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x069A8B38>]}
2020-10-12 03:23:12.941408 (Thread-1): 23:23:12 | 1 of 7 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.58s]
2020-10-12 03:23:12.942406 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-12 03:23:12.943403 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-12 03:23:12.944400 (Thread-1): 23:23:12 | 2 of 7 START view model dbt_atambay.orders........................... [RUN]
2020-10-12 03:23:12.946395 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-12 03:23:12.947392 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-12 03:23:12.947392 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-12 03:23:12.957366 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-12 03:23:12.958363 (Thread-1): finished collecting timing info
2020-10-12 03:23:12.965346 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-12 03:23:12.966342 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-12 03:23:13.610815 (Thread-1): finished collecting timing info
2020-10-12 03:23:13.611814 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x069A0F70>]}
2020-10-12 03:23:13.612816 (Thread-1): 23:23:13 | 2 of 7 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.67s]
2020-10-12 03:23:13.614110 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-12 03:23:13.615109 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-12 03:23:13.616143 (Thread-1): 23:23:13 | 3 of 7 START view model dbt_atambay.payments......................... [RUN]
2020-10-12 03:23:13.616143 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-12 03:23:13.616143 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-12 03:23:13.616143 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-12 03:23:13.626080 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-12 03:23:13.627077 (Thread-1): finished collecting timing info
2020-10-12 03:23:13.633061 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-12 03:23:13.634059 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-12 03:23:14.517622 (Thread-1): finished collecting timing info
2020-10-12 03:23:14.518619 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A39DF0>]}
2020-10-12 03:23:14.519621 (Thread-1): 23:23:14 | 3 of 7 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.90s]
2020-10-12 03:23:14.521575 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-12 03:23:14.521575 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-12 03:23:14.523570 (Thread-1): 23:23:14 | 4 of 7 START view model dbt_atambay.addresses........................ [RUN]
2020-10-12 03:23:14.524592 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-12 03:23:14.525564 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-12 03:23:14.525564 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-12 03:23:14.531584 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:23:14.532546 (Thread-1): finished collecting timing info
2020-10-12 03:23:14.535575 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-12 03:23:14.536534 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as select * from `fa--interview-task.interview.addresses`;


2020-10-12 03:23:15.231578 (Thread-1): finished collecting timing info
2020-10-12 03:23:15.231578 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x069E6FD0>]}
2020-10-12 03:23:15.232450 (Thread-1): 23:23:15 | 4 of 7 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.71s]
2020-10-12 03:23:15.234403 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-12 03:23:15.234403 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-12 03:23:15.235404 (Thread-1): 23:23:15 | 5 of 7 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-12 03:23:15.237396 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-12 03:23:15.237396 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-12 03:23:15.237396 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-12 03:23:15.246398 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:23:15.247404 (Thread-1): finished collecting timing info
2020-10-12 03:23:15.251396 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-12 03:23:15.252357 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
)

select * from xf;


2020-10-12 03:23:15.972416 (Thread-1): finished collecting timing info
2020-10-12 03:23:15.973404 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A398F8>]}
2020-10-12 03:23:15.974399 (Thread-1): 23:23:15 | 5 of 7 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.74s]
2020-10-12 03:23:15.976400 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-12 03:23:15.976400 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-12 03:23:15.977430 (Thread-1): 23:23:15 | 6 of 7 START view model dbt_atambay.first_order...................... [RUN]
2020-10-12 03:23:15.979956 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-12 03:23:15.979956 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-12 03:23:15.979956 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-12 03:23:15.987982 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:23:15.988930 (Thread-1): finished collecting timing info
2020-10-12 03:23:15.995911 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-12 03:23:15.996908 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-12 03:23:16.657661 (Thread-1): finished collecting timing info
2020-10-12 03:23:16.657661 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0698DCA0>]}
2020-10-12 03:23:16.659690 (Thread-1): 23:23:16 | 6 of 7 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.68s]
2020-10-12 03:23:16.660654 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-12 03:23:16.660654 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-12 03:23:16.661838 (Thread-1): 23:23:16 | 7 of 7 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-12 03:23:16.663647 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-12 03:23:16.664643 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-12 03:23:16.664643 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-12 03:23:16.671657 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-12 03:23:16.672621 (Thread-1): finished collecting timing info
2020-10-12 03:23:16.678606 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-12 03:23:16.679602 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-12 03:23:17.344973 (Thread-1): finished collecting timing info
2020-10-12 03:23:17.345971 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '664ce803-7ce4-42cf-9a18-d1f1babe1972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A398F8>]}
2020-10-12 03:23:17.345971 (Thread-1): 23:23:17 | 7 of 7 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.68s]
2020-10-12 03:23:17.347321 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-12 03:23:17.349317 (MainThread): Acquiring new bigquery connection "master".
2020-10-12 03:23:17.349317 (MainThread): Opening a new connection, currently in state closed
2020-10-12 03:23:17.349317 (MainThread): 23:23:17 | 
2020-10-12 03:23:17.350314 (MainThread): 23:23:17 | Finished running 7 view models in 7.07s.
2020-10-12 03:23:17.352311 (MainThread): Connection 'master' was properly closed.
2020-10-12 03:23:17.352311 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-12 03:23:17.352311 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-12 03:23:17.352311 (MainThread): Connection 'model.jaffle_shop.gross_payments' was left open.
2020-10-12 03:23:17.376247 (MainThread): 
2020-10-12 03:23:17.376247 (MainThread): Completed successfully
2020-10-12 03:23:17.389117 (MainThread): 
Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
2020-10-12 03:23:17.390118 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0697B928>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0685FF58>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06995CD0>]}
2020-10-12 03:23:17.390118 (MainThread): Flushing usage events
2020-10-13 02:39:23.677446 (MainThread): Running with dbt=0.17.0
2020-10-13 02:39:24.376335 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 02:39:24.378057 (MainThread): Tracking: tracking
2020-10-13 02:39:24.378057 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x054E1FE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x061732E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x061732F8>]}
2020-10-13 02:39:24.402375 (MainThread): Partial parsing not enabled
2020-10-13 02:39:24.413416 (MainThread): Parsing macros\core.sql
2020-10-13 02:39:24.419957 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 02:39:24.472359 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 02:39:24.485785 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 02:39:24.488799 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 02:39:24.491767 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 02:39:24.495762 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 02:39:24.498748 (MainThread): Parsing macros\etc\query.sql
2020-10-13 02:39:24.500744 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 02:39:24.510414 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 02:39:24.525411 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 02:39:24.528397 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 02:39:24.539339 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 02:39:24.568261 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 02:39:24.603169 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 02:39:24.606173 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 02:39:24.626110 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 02:39:24.635623 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 02:39:24.641979 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 02:39:24.648963 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 02:39:24.651993 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 02:39:24.652953 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 02:39:24.654985 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 02:39:24.659542 (MainThread): Parsing macros\adapters.sql
2020-10-13 02:39:24.677499 (MainThread): Parsing macros\catalog.sql
2020-10-13 02:39:24.683480 (MainThread): Parsing macros\etc.sql
2020-10-13 02:39:24.685512 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 02:39:24.699555 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 02:39:24.703617 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 02:39:24.707606 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 02:39:24.718581 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 02:39:24.740519 (MainThread): Partial parsing not enabled
2020-10-13 02:39:24.779451 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:39:24.779451 (MainThread): Opening a new connection, currently in state init
2020-10-13 02:39:24.811330 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:39:24.811330 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.821304 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:39:24.821304 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.835268 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:39:24.835268 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.847269 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:39:24.847269 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.861237 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:39:24.861237 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.875159 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:39:24.875159 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.889122 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 02:39:24.889122 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:24.900093 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:39:24.900093 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:25.045703 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 02:39:25.127489 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 02:39:25.129484 (MainThread): 
2020-10-13 02:39:25.129484 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:39:25.130477 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:25.158404 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 02:39:25.158404 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 02:39:25.911352 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 02:39:25.911352 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 02:39:25.912349 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 02:39:26.473214 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:39:26.473214 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:26.474206 (MainThread): 22:39:26 | Concurrency: 1 threads (target='dev')
2020-10-13 02:39:26.474206 (MainThread): 22:39:26 | 
2020-10-13 02:39:26.482185 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 02:39:26.484180 (Thread-1): 22:39:26 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 02:39:26.485177 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:39:26.485177 (Thread-1): Opening a new connection, currently in state init
2020-10-13 02:39:26.485177 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 02:39:26.512108 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 02:39:26.513105 (Thread-1): finished collecting timing info
2020-10-13 02:39:26.574128 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 02:39:26.576077 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 02:39:27.824608 (Thread-1): finished collecting timing info
2020-10-13 02:39:27.826604 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0631EF88>]}
2020-10-13 02:39:27.828597 (Thread-1): 22:39:27 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.34s]
2020-10-13 02:39:27.828597 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 02:39:27.829595 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 02:39:27.830593 (Thread-1): 22:39:27 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 02:39:27.834586 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:39:27.834586 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 02:39:27.834586 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 02:39:27.843649 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 02:39:27.847553 (Thread-1): finished collecting timing info
2020-10-13 02:39:27.858518 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 02:39:27.860515 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 02:39:28.868849 (Thread-1): finished collecting timing info
2020-10-13 02:39:28.869846 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062FB868>]}
2020-10-13 02:39:28.871841 (Thread-1): 22:39:28 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 1.04s]
2020-10-13 02:39:28.873838 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 02:39:28.874837 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 02:39:28.877825 (Thread-1): 22:39:28 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 02:39:28.886800 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:39:28.886800 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 02:39:28.886800 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 02:39:28.898768 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 02:39:28.899766 (Thread-1): finished collecting timing info
2020-10-13 02:39:28.911741 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 02:39:28.916720 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 02:39:29.653864 (Thread-1): finished collecting timing info
2020-10-13 02:39:29.654861 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062ED658>]}
2020-10-13 02:39:29.656857 (Thread-1): 22:39:29 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.77s]
2020-10-13 02:39:29.659727 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 02:39:29.660705 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 02:39:29.661730 (Thread-1): 22:39:29 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 02:39:29.663697 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:39:29.663697 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 02:39:29.663697 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 02:39:29.669712 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:39:29.670679 (Thread-1): finished collecting timing info
2020-10-13 02:39:29.675714 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:39:29.677659 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 02:39:30.881369 (Thread-1): finished collecting timing info
2020-10-13 02:39:30.882373 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062FBA48>]}
2020-10-13 02:39:30.884327 (Thread-1): 22:39:30 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 1.22s]
2020-10-13 02:39:30.885325 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 02:39:30.885325 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 02:39:30.887320 (Thread-1): 22:39:30 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 02:39:30.888318 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:39:30.888318 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 02:39:30.888318 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 02:39:30.902968 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:39:30.903964 (Thread-1): finished collecting timing info
2020-10-13 02:39:30.912912 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:39:30.914900 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN d.device = 'web' THEN 'desktop' 
            WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when d.device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(d.device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 02:39:31.464789 (Thread-1): finished collecting timing info
2020-10-13 02:39:31.466801 (Thread-1): Database Error in model first_order_device (models\transform\first_order_device.sql)
  Unrecognized name: d at [24:18]
  compiled SQL at target\run\jaffle_shop\models\transform\first_order_device.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/933891ff-5156-4081-a4e5-f36433b5b0f4?maxResults=0&location=US: Unrecognized name: d at [24:18]

(job ID: 933891ff-5156-4081-a4e5-f36433b5b0f4)

                                                            -----Query Job SQL Follows-----                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
   5:  OPTIONS()
   6:  as with devices as (
   7:    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
   8:),
   9:
  10:xf as (
  11:    select 
  12:        distinct cast(type_id as int64) as order_id, 
  13:                 first_value(device) OVER (partition by type_id order by created_at 
  14:                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
  15:                                          ) as device 
  16:    from devices 
  17:    where type = 'order'
  18:),
  19:
  20:categories as (
  21:    select 
  22:        *,
  23:        CASE 
  24:            WHEN d.device = 'web' THEN 'desktop' 
  25:            WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app' 
  26:            when d.device IN ('mobile', 'tablet') THEN 'mobile-web' 
  27:            when NULLIF(d.device, '') IS NULL THEN 'unknown' 
  28:            ELSE 'ERROR' 
  29:        END AS purchase_device_type
  30:    from xf
  31:)
  32:
  33:select * from categories;
  34:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model first_order_device (models\transform\first_order_device.sql)
  Unrecognized name: d at [24:18]
  compiled SQL at target\run\jaffle_shop\models\transform\first_order_device.sql
2020-10-13 02:39:31.490704 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0628E0D0>]}
2020-10-13 02:39:31.491700 (Thread-1): 22:39:31 | 5 of 8 ERROR creating view model dbt_atambay.first_order_device...... [ERROR in 0.60s]
2020-10-13 02:39:31.493560 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 02:39:31.494553 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 02:39:31.495578 (Thread-1): 22:39:31 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 02:39:31.497714 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:39:31.497714 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 02:39:31.497714 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 02:39:31.508774 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:39:31.510720 (Thread-1): finished collecting timing info
2020-10-13 02:39:31.515666 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:39:31.516663 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 02:39:32.216306 (Thread-1): finished collecting timing info
2020-10-13 02:39:32.216306 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062FC520>]}
2020-10-13 02:39:32.217303 (Thread-1): 22:39:32 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.72s]
2020-10-13 02:39:32.219299 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 02:39:32.219299 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 02:39:32.220312 (Thread-1): 22:39:32 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 02:39:32.222294 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:39:32.223286 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 02:39:32.223286 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 02:39:32.234256 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:39:32.235254 (Thread-1): finished collecting timing info
2020-10-13 02:39:32.246225 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:39:32.248240 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 02:39:32.944069 (Thread-1): finished collecting timing info
2020-10-13 02:39:32.945067 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c85f83-21e1-4928-96c2-e54a5543b7a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06FAEBB0>]}
2020-10-13 02:39:32.947047 (Thread-1): 22:39:32 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.72s]
2020-10-13 02:39:32.949008 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 02:39:32.950007 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 02:39:32.950007 (Thread-1): 22:39:32 | 8 of 8 SKIP relation dbt_atambay.order_details....................... [SKIP]
2020-10-13 02:39:32.952183 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 02:39:32.954184 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:39:32.954184 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:39:32.955222 (MainThread): 22:39:32 | 
2020-10-13 02:39:32.956235 (MainThread): 22:39:32 | Finished running 8 view models in 7.82s.
2020-10-13 02:39:32.957174 (MainThread): Connection 'master' was properly closed.
2020-10-13 02:39:32.957174 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 02:39:32.957174 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 02:39:32.957174 (MainThread): Connection 'model.jaffle_shop.gross_payments' was left open.
2020-10-13 02:39:33.000066 (MainThread): 
2020-10-13 02:39:33.001061 (MainThread): Completed with 1 error and 0 warnings:
2020-10-13 02:39:33.009045 (MainThread): 
2020-10-13 02:39:33.025988 (MainThread): Database Error in model first_order_device (models\transform\first_order_device.sql)
2020-10-13 02:39:33.028983 (MainThread):   Unrecognized name: d at [24:18]
2020-10-13 02:39:33.037957 (MainThread):   compiled SQL at target\run\jaffle_shop\models\transform\first_order_device.sql
2020-10-13 02:39:33.038956 (MainThread): 
Done. PASS=6 WARN=0 ERROR=1 SKIP=1 TOTAL=8
2020-10-13 02:39:33.040991 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06FAEBE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06FAEEF8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06FAEF70>]}
2020-10-13 02:39:33.041946 (MainThread): Flushing usage events
2020-10-13 02:40:19.072538 (MainThread): Running with dbt=0.17.0
2020-10-13 02:40:19.437663 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 02:40:19.437663 (MainThread): Tracking: tracking
2020-10-13 02:40:19.438661 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x055B1FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062423B8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06242430>]}
2020-10-13 02:40:19.463595 (MainThread): Partial parsing not enabled
2020-10-13 02:40:19.466587 (MainThread): Parsing macros\core.sql
2020-10-13 02:40:19.473608 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 02:40:19.530417 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 02:40:19.542425 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 02:40:19.543423 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 02:40:19.545415 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 02:40:19.547370 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 02:40:19.549405 (MainThread): Parsing macros\etc\query.sql
2020-10-13 02:40:19.550400 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 02:40:19.560375 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 02:40:19.578325 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 02:40:19.581312 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 02:40:19.589295 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 02:40:19.615229 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 02:40:19.654134 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 02:40:19.657185 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 02:40:19.675076 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 02:40:19.683055 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 02:40:19.689039 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 02:40:19.697064 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 02:40:19.699051 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 02:40:19.700051 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 02:40:19.701045 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 02:40:19.703999 (MainThread): Parsing macros\adapters.sql
2020-10-13 02:40:19.721952 (MainThread): Parsing macros\catalog.sql
2020-10-13 02:40:19.728974 (MainThread): Parsing macros\etc.sql
2020-10-13 02:40:19.729969 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 02:40:19.744930 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 02:40:19.746923 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 02:40:19.748916 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 02:40:19.759888 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 02:40:19.785782 (MainThread): Partial parsing not enabled
2020-10-13 02:40:19.830661 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:40:19.830661 (MainThread): Opening a new connection, currently in state init
2020-10-13 02:40:19.864571 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:40:19.864571 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.877536 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:40:19.877536 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.889504 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:40:19.889504 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.901472 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:40:19.902470 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.915434 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:40:19.915434 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.927401 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:40:19.927401 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.938372 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 02:40:19.939379 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:19.948389 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:40:19.949392 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:20.064585 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 02:40:20.131434 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 02:40:20.132359 (MainThread): 
2020-10-13 02:40:20.133398 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:40:20.133398 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:20.151315 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 02:40:20.152318 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 02:40:20.748011 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 02:40:20.748979 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 02:40:20.748979 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 02:40:21.305105 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:40:21.305105 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:21.306102 (MainThread): 22:40:21 | Concurrency: 1 threads (target='dev')
2020-10-13 02:40:21.307107 (MainThread): 22:40:21 | 
2020-10-13 02:40:21.314081 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 02:40:21.315078 (Thread-1): 22:40:21 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 02:40:21.316076 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:40:21.316076 (Thread-1): Opening a new connection, currently in state init
2020-10-13 02:40:21.316076 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 02:40:21.337019 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 02:40:21.338018 (Thread-1): finished collecting timing info
2020-10-13 02:40:21.388882 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 02:40:21.390892 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 02:40:22.749716 (Thread-1): finished collecting timing info
2020-10-13 02:40:22.750712 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06350EC8>]}
2020-10-13 02:40:22.751710 (Thread-1): 22:40:22 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.44s]
2020-10-13 02:40:22.752707 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 02:40:22.752707 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 02:40:22.754701 (Thread-1): 22:40:22 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 02:40:22.757694 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:40:22.757694 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 02:40:22.757694 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 02:40:22.766670 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 02:40:22.767666 (Thread-1): finished collecting timing info
2020-10-13 02:40:22.774651 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 02:40:22.776655 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 02:40:23.510637 (Thread-1): finished collecting timing info
2020-10-13 02:40:23.511636 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063D7730>]}
2020-10-13 02:40:23.511636 (Thread-1): 22:40:23 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.75s]
2020-10-13 02:40:23.514183 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 02:40:23.514183 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 02:40:23.515204 (Thread-1): 22:40:23 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 02:40:23.518159 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:40:23.518159 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 02:40:23.518159 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 02:40:23.524144 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 02:40:23.525140 (Thread-1): finished collecting timing info
2020-10-13 02:40:23.530128 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 02:40:23.531125 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 02:40:24.222431 (Thread-1): finished collecting timing info
2020-10-13 02:40:24.223428 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063D70B8>]}
2020-10-13 02:40:24.224425 (Thread-1): 22:40:24 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.71s]
2020-10-13 02:40:24.225401 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 02:40:24.226389 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 02:40:24.227383 (Thread-1): 22:40:24 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 02:40:24.231373 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:40:24.231373 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 02:40:24.231373 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 02:40:24.238389 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:40:24.239421 (Thread-1): finished collecting timing info
2020-10-13 02:40:24.243340 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:40:24.245381 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 02:40:24.885155 (Thread-1): finished collecting timing info
2020-10-13 02:40:24.886153 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06374100>]}
2020-10-13 02:40:24.887149 (Thread-1): 22:40:24 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.65s]
2020-10-13 02:40:24.888147 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 02:40:24.889144 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 02:40:24.890141 (Thread-1): 22:40:24 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 02:40:24.892135 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:40:24.893132 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 02:40:24.893132 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 02:40:24.903104 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:40:24.904101 (Thread-1): finished collecting timing info
2020-10-13 02:40:24.910099 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:40:24.911084 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 02:40:25.577879 (Thread-1): finished collecting timing info
2020-10-13 02:40:25.578906 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0635E118>]}
2020-10-13 02:40:25.581900 (Thread-1): 22:40:25 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.69s]
2020-10-13 02:40:25.583859 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 02:40:25.583859 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 02:40:25.585882 (Thread-1): 22:40:25 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 02:40:25.587848 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:40:25.587848 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 02:40:25.587848 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 02:40:25.598819 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:40:25.599817 (Thread-1): finished collecting timing info
2020-10-13 02:40:25.604802 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:40:25.605836 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 02:40:26.301687 (Thread-1): finished collecting timing info
2020-10-13 02:40:26.302686 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063D77C0>]}
2020-10-13 02:40:26.304682 (Thread-1): 22:40:26 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.72s]
2020-10-13 02:40:26.306646 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 02:40:26.306646 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 02:40:26.308647 (Thread-1): 22:40:26 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 02:40:26.311630 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:40:26.311630 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 02:40:26.311630 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 02:40:26.322639 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:40:26.323609 (Thread-1): finished collecting timing info
2020-10-13 02:40:26.327628 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:40:26.328586 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 02:40:26.999968 (Thread-1): finished collecting timing info
2020-10-13 02:40:26.999968 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06FBD190>]}
2020-10-13 02:40:27.000967 (Thread-1): 22:40:27 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.69s]
2020-10-13 02:40:27.002921 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 02:40:27.002921 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 02:40:27.003920 (Thread-1): 22:40:27 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 02:40:27.004916 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:40:27.005934 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 02:40:27.005934 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 02:40:27.018880 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:40:27.019877 (Thread-1): finished collecting timing info
2020-10-13 02:40:27.024903 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:40:27.025926 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order_device.first_order_id,
        orders.amount_total_cents,
        gross_payments.gross_total_amount_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
)

select * from joined;


2020-10-13 02:40:27.547997 (Thread-1): finished collecting timing info
2020-10-13 02:40:27.550006 (Thread-1): Database Error in model order_details (models\transform\order_details.sql)
  Name first_order_id not found inside first_order_device at [40:28]
  compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/db79c78e-9d78-44e0-84d7-30ad125f3b43?maxResults=0&location=US: Name first_order_id not found inside first_order_device at [40:28]

(job ID: db79c78e-9d78-44e0-84d7-30ad125f3b43)

                                                         -----Query Job SQL Follows-----                                                          

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
   5:  OPTIONS()
   6:  as with orders as (
   7:    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
   8:),
   9:
  10:first_order_device as (
  11:    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  12:),
  13:
  14:first_order as (
  15:    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  16:),
  17:
  18:addresses as (
  19:    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  20:),
  21:
  22:gross_payments as (
  23:    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  24:),
  25:
  26:joined as (
  27:    SELECT
  28:        orders.order_id, 
  29:        orders.user_id, 
  30:        orders.created_at, 
  31:        orders.updated_at, 
  32:        orders.shipped_at, 
  33:        orders.currency, 
  34:        orders.status AS order_status,
  35:        orders.order_status_category,
  36:        addresses.country_type,
  37:        orders.shipping_method,
  38:        first_order_device.purchase_device_type,
  39:        first_order_device.device as purchase_device,
  40:        first_order_device.first_order_id,
  41:        orders.amount_total_cents,
  42:        gross_payments.gross_total_amount_cents,
  43:        gross_payments.gross_tax_amount_cents, 
  44:        gross_payments.gross_amount_cents, 
  45:        gross_payments.gross_shipping_amount_cents
  46:    from orders 
  47:    left join first_order_device
  48:    using (order_id)
  49:    left join first_order
  50:    using (user_id)
  51:    left join addresses
  52:    using (order_id)
  53:    left join gross_payments
  54:    using (order_id)
  55:)
  56:
  57:select * from joined;
  58:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model order_details (models\transform\order_details.sql)
  Name first_order_id not found inside first_order_device at [40:28]
  compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
2020-10-13 02:40:27.557006 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf66b9e5-1f9e-405f-a832-113c22fe36c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06382D60>]}
2020-10-13 02:40:27.558003 (Thread-1): 22:40:27 | 8 of 8 ERROR creating view model dbt_atambay.order_details........... [ERROR in 0.55s]
2020-10-13 02:40:27.558642 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 02:40:27.559642 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:40:27.560638 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:40:27.560638 (MainThread): 22:40:27 | 
2020-10-13 02:40:27.562634 (MainThread): 22:40:27 | Finished running 8 view models in 7.43s.
2020-10-13 02:40:27.563633 (MainThread): Connection 'master' was properly closed.
2020-10-13 02:40:27.563633 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 02:40:27.563633 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 02:40:27.563633 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 02:40:27.591557 (MainThread): 
2020-10-13 02:40:27.591557 (MainThread): Completed with 1 error and 0 warnings:
2020-10-13 02:40:27.593551 (MainThread): 
2020-10-13 02:40:27.595588 (MainThread): Database Error in model order_details (models\transform\order_details.sql)
2020-10-13 02:40:27.606637 (MainThread):   Name first_order_id not found inside first_order_device at [40:28]
2020-10-13 02:40:27.607638 (MainThread):   compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
2020-10-13 02:40:27.608636 (MainThread): 
Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
2020-10-13 02:40:27.610674 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063C7CE8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063FA118>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063FAA60>]}
2020-10-13 02:40:27.611626 (MainThread): Flushing usage events
2020-10-13 02:42:14.904239 (MainThread): Running with dbt=0.17.0
2020-10-13 02:42:15.243056 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 02:42:15.243056 (MainThread): Tracking: tracking
2020-10-13 02:42:15.243982 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x059F1FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06681310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06681250>]}
2020-10-13 02:42:15.263929 (MainThread): Partial parsing not enabled
2020-10-13 02:42:15.267959 (MainThread): Parsing macros\core.sql
2020-10-13 02:42:15.272947 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 02:42:15.329751 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 02:42:15.339724 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 02:42:15.340722 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 02:42:15.342716 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 02:42:15.344711 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 02:42:15.346705 (MainThread): Parsing macros\etc\query.sql
2020-10-13 02:42:15.347703 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 02:42:15.357678 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 02:42:15.374631 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 02:42:15.376625 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 02:42:15.385603 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 02:42:15.415521 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 02:42:15.449431 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 02:42:15.452424 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 02:42:15.475866 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 02:42:15.482848 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 02:42:15.489835 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 02:42:15.496810 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 02:42:15.499803 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 02:42:15.500800 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 02:42:15.501797 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 02:42:15.503792 (MainThread): Parsing macros\adapters.sql
2020-10-13 02:42:15.523743 (MainThread): Parsing macros\catalog.sql
2020-10-13 02:42:15.530720 (MainThread): Parsing macros\etc.sql
2020-10-13 02:42:15.531717 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 02:42:15.547674 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 02:42:15.549669 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 02:42:15.551664 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 02:42:15.565135 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 02:42:15.588074 (MainThread): Partial parsing not enabled
2020-10-13 02:42:15.628915 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:42:15.628915 (MainThread): Opening a new connection, currently in state init
2020-10-13 02:42:15.661906 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:42:15.661906 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.670843 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:42:15.670843 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.679849 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:42:15.679849 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.689834 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:42:15.689834 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.701794 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:42:15.701794 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.714759 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:42:15.714759 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.727723 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 02:42:15.727723 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.737243 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:42:15.738275 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.856549 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 02:42:15.919340 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 02:42:15.920337 (MainThread): 
2020-10-13 02:42:15.920337 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:42:15.921415 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:15.931306 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 02:42:15.931306 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 02:42:16.562689 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 02:42:16.562689 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 02:42:16.563686 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 02:42:17.118640 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:42:17.118640 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:17.118640 (MainThread): 22:42:17 | Concurrency: 1 threads (target='dev')
2020-10-13 02:42:17.119638 (MainThread): 22:42:17 | 
2020-10-13 02:42:17.127615 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 02:42:17.129610 (Thread-1): 22:42:17 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 02:42:17.135595 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:42:17.135595 (Thread-1): Opening a new connection, currently in state init
2020-10-13 02:42:17.135595 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 02:42:17.157537 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 02:42:17.160531 (Thread-1): finished collecting timing info
2020-10-13 02:42:17.202442 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 02:42:17.203413 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 02:42:18.453494 (Thread-1): finished collecting timing info
2020-10-13 02:42:18.454525 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067B1250>]}
2020-10-13 02:42:18.455453 (Thread-1): 22:42:18 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.32s]
2020-10-13 02:42:18.456451 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 02:42:18.456451 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 02:42:18.459452 (Thread-1): 22:42:18 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 02:42:18.462439 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:42:18.463432 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 02:42:18.463432 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 02:42:18.475442 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 02:42:18.476446 (Thread-1): finished collecting timing info
2020-10-13 02:42:18.484382 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 02:42:18.485373 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 02:42:19.371821 (Thread-1): finished collecting timing info
2020-10-13 02:42:19.372815 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0680BA00>]}
2020-10-13 02:42:19.375750 (Thread-1): 22:42:19 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.91s]
2020-10-13 02:42:19.377744 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 02:42:19.378740 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 02:42:19.380733 (Thread-1): 22:42:19 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 02:42:19.381732 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:42:19.381732 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 02:42:19.381732 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 02:42:19.390706 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 02:42:19.392706 (Thread-1): finished collecting timing info
2020-10-13 02:42:19.397714 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 02:42:19.398702 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 02:42:20.246593 (Thread-1): finished collecting timing info
2020-10-13 02:42:20.246593 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0680B478>]}
2020-10-13 02:42:20.247590 (Thread-1): 22:42:20 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.86s]
2020-10-13 02:42:20.249504 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 02:42:20.249504 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 02:42:20.250503 (Thread-1): 22:42:20 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 02:42:20.251500 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:42:20.251500 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 02:42:20.251500 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 02:42:20.259504 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:42:20.260490 (Thread-1): finished collecting timing info
2020-10-13 02:42:20.263482 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:42:20.264490 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 02:42:21.187803 (Thread-1): finished collecting timing info
2020-10-13 02:42:21.188800 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067ED910>]}
2020-10-13 02:42:21.189798 (Thread-1): 22:42:21 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.94s]
2020-10-13 02:42:21.190807 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 02:42:21.190807 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 02:42:21.192790 (Thread-1): 22:42:21 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 02:42:21.195789 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:42:21.195789 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 02:42:21.196784 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 02:42:21.204796 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:42:21.205756 (Thread-1): finished collecting timing info
2020-10-13 02:42:21.212780 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:42:21.214736 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 02:42:21.818455 (Thread-1): finished collecting timing info
2020-10-13 02:42:21.820454 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06789070>]}
2020-10-13 02:42:21.821447 (Thread-1): 22:42:21 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.62s]
2020-10-13 02:42:21.823411 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 02:42:21.823411 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 02:42:21.825407 (Thread-1): 22:42:21 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 02:42:21.827403 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:42:21.827403 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 02:42:21.827403 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 02:42:21.838369 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:42:21.839366 (Thread-1): finished collecting timing info
2020-10-13 02:42:21.842358 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:42:21.843356 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 02:42:22.604158 (Thread-1): finished collecting timing info
2020-10-13 02:42:22.605162 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067ED910>]}
2020-10-13 02:42:22.605162 (Thread-1): 22:42:22 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.78s]
2020-10-13 02:42:22.607113 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 02:42:22.607113 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 02:42:22.608152 (Thread-1): 22:42:22 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 02:42:22.609108 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:42:22.609108 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 02:42:22.609108 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 02:42:22.618086 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:42:22.619124 (Thread-1): finished collecting timing info
2020-10-13 02:42:22.623114 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:42:22.624068 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 02:42:23.277582 (Thread-1): finished collecting timing info
2020-10-13 02:42:23.278528 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x07401BF8>]}
2020-10-13 02:42:23.280579 (Thread-1): 22:42:23 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.67s]
2020-10-13 02:42:23.282517 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 02:42:23.283515 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 02:42:23.285511 (Thread-1): 22:42:23 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 02:42:23.286508 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:42:23.287570 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 02:42:23.287570 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 02:42:23.305523 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:42:23.306497 (Thread-1): finished collecting timing info
2020-10-13 02:42:23.310565 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:42:23.312481 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order.first_order_id,
        orders.amount_total_cents,
        gross_payments.gross_total_amount_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
)

select * from joined;


2020-10-13 02:42:24.256897 (Thread-1): finished collecting timing info
2020-10-13 02:42:24.256897 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98676823-bb52-400f-9973-d598b49ed80d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0683A7C0>]}
2020-10-13 02:42:24.257895 (Thread-1): 22:42:24 | 8 of 8 OK created view model dbt_atambay.order_details............... [CREATE VIEW in 0.97s]
2020-10-13 02:42:24.260339 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 02:42:24.261336 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:42:24.261336 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:42:24.261336 (MainThread): 22:42:24 | 
2020-10-13 02:42:24.262333 (MainThread): 22:42:24 | Finished running 8 view models in 8.34s.
2020-10-13 02:42:24.265326 (MainThread): Connection 'master' was properly closed.
2020-10-13 02:42:24.265326 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 02:42:24.266365 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 02:42:24.266365 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 02:42:24.290259 (MainThread): 
2020-10-13 02:42:24.291257 (MainThread): Completed successfully
2020-10-13 02:42:24.292253 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2020-10-13 02:42:24.293250 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x073DFC88>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06807328>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x068072C8>]}
2020-10-13 02:42:24.293250 (MainThread): Flushing usage events
2020-10-13 02:46:37.001601 (MainThread): Running with dbt=0.17.0
2020-10-13 02:46:37.349120 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 02:46:37.350130 (MainThread): Tracking: tracking
2020-10-13 02:46:37.350130 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05021F28>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05CAC2C8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05CAC2E0>]}
2020-10-13 02:46:37.377046 (MainThread): Partial parsing not enabled
2020-10-13 02:46:37.380038 (MainThread): Parsing macros\core.sql
2020-10-13 02:46:37.387055 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 02:46:37.444899 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 02:46:37.456865 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 02:46:37.458861 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 02:46:37.460858 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 02:46:37.462853 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 02:46:37.464851 (MainThread): Parsing macros\etc\query.sql
2020-10-13 02:46:37.466846 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 02:46:37.476814 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 02:46:37.495727 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 02:46:37.497762 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 02:46:37.507694 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 02:46:37.529636 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 02:46:37.567548 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 02:46:37.570527 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 02:46:37.596457 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 02:46:37.606432 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 02:46:37.612414 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 02:46:37.622391 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 02:46:37.624383 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 02:46:37.625380 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 02:46:37.626377 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 02:46:37.629369 (MainThread): Parsing macros\adapters.sql
2020-10-13 02:46:37.651542 (MainThread): Parsing macros\catalog.sql
2020-10-13 02:46:37.659478 (MainThread): Parsing macros\etc.sql
2020-10-13 02:46:37.659478 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 02:46:37.678426 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 02:46:37.680421 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 02:46:37.683416 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 02:46:37.697417 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 02:46:37.729292 (MainThread): Partial parsing not enabled
2020-10-13 02:46:37.777508 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:46:37.777508 (MainThread): Opening a new connection, currently in state init
2020-10-13 02:46:37.807713 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:46:37.807713 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.816608 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:46:37.817608 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.827617 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:46:37.827617 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.836596 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:46:37.836596 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.846609 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:46:37.846609 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.858615 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:46:37.858615 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.871542 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 02:46:37.871542 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:37.879524 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:46:37.879524 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:38.001369 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 02:46:38.060812 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 02:46:38.062803 (MainThread): 
2020-10-13 02:46:38.062803 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:46:38.062803 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:38.078775 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 02:46:38.079759 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 02:46:38.710675 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 02:46:38.710675 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 02:46:38.711672 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 02:46:39.286189 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:46:39.286189 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:39.287188 (MainThread): 22:46:39 | Concurrency: 1 threads (target='dev')
2020-10-13 02:46:39.288185 (MainThread): 22:46:39 | 
2020-10-13 02:46:39.293170 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 02:46:39.295170 (Thread-1): 22:46:39 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 02:46:39.305137 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 02:46:39.305137 (Thread-1): Opening a new connection, currently in state init
2020-10-13 02:46:39.305137 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 02:46:39.331133 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 02:46:39.332111 (Thread-1): finished collecting timing info
2020-10-13 02:46:39.381931 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 02:46:39.383926 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 02:46:40.608527 (Thread-1): finished collecting timing info
2020-10-13 02:46:40.608527 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DE2FA0>]}
2020-10-13 02:46:40.610492 (Thread-1): 22:46:40 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.30s]
2020-10-13 02:46:40.611488 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 02:46:40.611488 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 02:46:40.612485 (Thread-1): 22:46:40 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 02:46:40.613482 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 02:46:40.613482 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 02:46:40.613482 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 02:46:40.623457 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 02:46:40.624453 (Thread-1): finished collecting timing info
2020-10-13 02:46:40.631442 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 02:46:40.631442 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 02:46:41.435463 (Thread-1): finished collecting timing info
2020-10-13 02:46:41.436405 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DD3760>]}
2020-10-13 02:46:41.439403 (Thread-1): 22:46:41 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.82s]
2020-10-13 02:46:41.440380 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 02:46:41.441375 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 02:46:41.442451 (Thread-1): 22:46:41 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 02:46:41.445483 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 02:46:41.445483 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 02:46:41.445483 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 02:46:41.451465 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 02:46:41.451465 (Thread-1): finished collecting timing info
2020-10-13 02:46:41.457488 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 02:46:41.458472 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 02:46:42.331807 (Thread-1): finished collecting timing info
2020-10-13 02:46:42.332665 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E3BD90>]}
2020-10-13 02:46:42.333661 (Thread-1): 22:46:42 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.89s]
2020-10-13 02:46:42.335305 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 02:46:42.335305 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 02:46:42.335305 (Thread-1): 22:46:42 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 02:46:42.336339 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 02:46:42.337304 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 02:46:42.337304 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 02:46:42.345281 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:46:42.346276 (Thread-1): finished collecting timing info
2020-10-13 02:46:42.350290 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 02:46:42.350290 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 02:46:42.946923 (Thread-1): finished collecting timing info
2020-10-13 02:46:42.946923 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DD3760>]}
2020-10-13 02:46:42.947921 (Thread-1): 22:46:42 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.61s]
2020-10-13 02:46:42.949916 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 02:46:42.949916 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 02:46:42.950913 (Thread-1): 22:46:42 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 02:46:42.951912 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 02:46:42.951912 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 02:46:42.951912 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 02:46:42.962979 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:46:42.962979 (Thread-1): finished collecting timing info
2020-10-13 02:46:42.966967 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 02:46:42.966967 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 02:46:43.668735 (Thread-1): finished collecting timing info
2020-10-13 02:46:43.669732 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DBF0A0>]}
2020-10-13 02:46:43.670730 (Thread-1): 22:46:43 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.72s]
2020-10-13 02:46:43.671688 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 02:46:43.671688 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 02:46:43.674683 (Thread-1): 22:46:43 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 02:46:43.677672 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 02:46:43.677672 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 02:46:43.677672 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 02:46:43.685649 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:46:43.686646 (Thread-1): finished collecting timing info
2020-10-13 02:46:43.693676 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 02:46:43.694625 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 02:46:44.367717 (Thread-1): finished collecting timing info
2020-10-13 02:46:44.368714 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DD3B80>]}
2020-10-13 02:46:44.369711 (Thread-1): 22:46:44 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.69s]
2020-10-13 02:46:44.371514 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 02:46:44.371514 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 02:46:44.372511 (Thread-1): 22:46:44 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 02:46:44.373508 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 02:46:44.374511 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 02:46:44.374511 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 02:46:44.384787 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:46:44.385516 (Thread-1): finished collecting timing info
2020-10-13 02:46:44.390463 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 02:46:44.392459 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 02:46:45.264387 (Thread-1): finished collecting timing info
2020-10-13 02:46:45.265389 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06A321F0>]}
2020-10-13 02:46:45.266383 (Thread-1): 22:46:45 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.89s]
2020-10-13 02:46:45.266888 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 02:46:45.267888 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 02:46:45.268954 (Thread-1): 22:46:45 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 02:46:45.271895 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 02:46:45.271895 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 02:46:45.271895 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 02:46:45.285840 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:46:45.286876 (Thread-1): finished collecting timing info
2020-10-13 02:46:45.295815 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 02:46:45.297809 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order.first_order_id,
        orders.amount_total_cents,
        gross_payments.gross_total_amount_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
),

categories as (
    select *,
           case 
                when first_order_id = order_id THEN 'new' 
                else 'repeat' 
           end as user_type,
           case
                when currency = 'USD' then amount_total_cents 
                else gross_total_amount_cents 
           end as total_amount_cents
    from joined
)

select * from categories;


2020-10-13 02:46:46.259624 (Thread-1): finished collecting timing info
2020-10-13 02:46:46.260626 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65abc527-4436-4fc0-90a3-f3a7e6049a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E463D0>]}
2020-10-13 02:46:46.261615 (Thread-1): 22:46:46 | 8 of 8 OK created view model dbt_atambay.order_details............... [CREATE VIEW in 0.99s]
2020-10-13 02:46:46.263421 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 02:46:46.264408 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 02:46:46.264408 (MainThread): Opening a new connection, currently in state closed
2020-10-13 02:46:46.264408 (MainThread): 22:46:46 | 
2020-10-13 02:46:46.265407 (MainThread): 22:46:46 | Finished running 8 view models in 8.20s.
2020-10-13 02:46:46.267400 (MainThread): Connection 'master' was properly closed.
2020-10-13 02:46:46.268400 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 02:46:46.268400 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 02:46:46.268400 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 02:46:46.304302 (MainThread): 
2020-10-13 02:46:46.304302 (MainThread): Completed successfully
2020-10-13 02:46:46.306307 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2020-10-13 02:46:46.307312 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05DE27C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E5E670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05E5EF28>]}
2020-10-13 02:46:46.308292 (MainThread): Flushing usage events
2020-10-13 03:02:33.056004 (MainThread): Running with dbt=0.17.0
2020-10-13 03:02:33.409073 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 03:02:33.410082 (MainThread): Tracking: tracking
2020-10-13 03:02:33.410082 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x057C1FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05C53400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05C53280>]}
2020-10-13 03:02:33.432064 (MainThread): Partial parsing not enabled
2020-10-13 03:02:33.435009 (MainThread): Parsing macros\core.sql
2020-10-13 03:02:33.440996 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 03:02:33.501863 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 03:02:33.512836 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 03:02:33.514829 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 03:02:33.515825 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 03:02:33.518817 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 03:02:33.520777 (MainThread): Parsing macros\etc\query.sql
2020-10-13 03:02:33.522824 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 03:02:33.531782 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 03:02:33.548739 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 03:02:33.550731 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 03:02:33.559709 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 03:02:33.587599 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 03:02:33.623501 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 03:02:33.625496 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 03:02:33.644489 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 03:02:33.651471 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 03:02:33.658422 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 03:02:33.665389 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 03:02:33.669379 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 03:02:33.671374 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 03:02:33.674370 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 03:02:33.678354 (MainThread): Parsing macros\adapters.sql
2020-10-13 03:02:33.697340 (MainThread): Parsing macros\catalog.sql
2020-10-13 03:02:33.704286 (MainThread): Parsing macros\etc.sql
2020-10-13 03:02:33.705322 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 03:02:33.718289 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 03:02:33.721253 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 03:02:33.724288 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 03:02:33.735241 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 03:02:33.762843 (MainThread): Partial parsing not enabled
2020-10-13 03:02:33.809679 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:02:33.809679 (MainThread): Opening a new connection, currently in state init
2020-10-13 03:02:33.845583 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:02:33.845583 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.859258 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:02:33.859258 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.867237 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:02:33.867237 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.879205 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:02:33.879205 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.892171 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:02:33.893169 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.906135 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:02:33.906135 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.917142 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 03:02:33.917142 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:33.928074 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:02:33.928074 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:34.085652 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 03:02:34.181400 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 03:02:34.183414 (MainThread): 
2020-10-13 03:02:34.184390 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:02:34.184390 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:34.205334 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 03:02:34.206335 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 03:02:34.895401 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 03:02:34.895401 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 03:02:34.896398 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 03:02:35.482150 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:02:35.483146 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:35.483146 (MainThread): 23:02:35 | Concurrency: 1 threads (target='dev')
2020-10-13 03:02:35.484143 (MainThread): 23:02:35 | 
2020-10-13 03:02:35.488132 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 03:02:35.491130 (Thread-1): 23:02:35 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 03:02:35.500101 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:02:35.501099 (Thread-1): Opening a new connection, currently in state init
2020-10-13 03:02:35.501099 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 03:02:35.529024 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 03:02:35.530026 (Thread-1): finished collecting timing info
2020-10-13 03:02:35.587855 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 03:02:35.589925 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 03:02:36.835942 (Thread-1): finished collecting timing info
2020-10-13 03:02:36.837937 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06566CB8>]}
2020-10-13 03:02:36.840931 (Thread-1): 23:02:36 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.34s]
2020-10-13 03:02:36.842928 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 03:02:36.843926 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 03:02:36.846914 (Thread-1): 23:02:36 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 03:02:36.848908 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:02:36.848908 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 03:02:36.848908 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 03:02:36.865863 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 03:02:36.866860 (Thread-1): finished collecting timing info
2020-10-13 03:02:36.878831 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 03:02:36.879828 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 03:02:37.575798 (Thread-1): finished collecting timing info
2020-10-13 03:02:37.577787 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06572418>]}
2020-10-13 03:02:37.579775 (Thread-1): 23:02:37 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.73s]
2020-10-13 03:02:37.581769 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 03:02:37.581769 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 03:02:37.583762 (Thread-1): 23:02:37 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 03:02:37.584759 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:02:37.584759 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 03:02:37.585757 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 03:02:37.601715 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 03:02:37.602712 (Thread-1): finished collecting timing info
2020-10-13 03:02:37.613683 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 03:02:37.615677 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 03:02:38.541948 (Thread-1): finished collecting timing info
2020-10-13 03:02:38.543972 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065DA520>]}
2020-10-13 03:02:38.545939 (Thread-1): 23:02:38 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.96s]
2020-10-13 03:02:38.548945 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 03:02:38.548945 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 03:02:38.549927 (Thread-1): 23:02:38 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 03:02:38.550925 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:02:38.550925 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 03:02:38.550925 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 03:02:38.559905 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:02:38.560896 (Thread-1): finished collecting timing info
2020-10-13 03:02:38.566880 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:02:38.567877 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 03:02:39.300109 (Thread-1): finished collecting timing info
2020-10-13 03:02:39.301105 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06572E80>]}
2020-10-13 03:02:39.302101 (Thread-1): 23:02:39 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.75s]
2020-10-13 03:02:39.304096 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 03:02:39.304096 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 03:02:39.305169 (Thread-1): 23:02:39 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 03:02:39.307088 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:02:39.308107 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 03:02:39.308107 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 03:02:39.318060 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:02:39.319057 (Thread-1): finished collecting timing info
2020-10-13 03:02:39.325042 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:02:39.325042 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 03:02:40.226181 (Thread-1): finished collecting timing info
2020-10-13 03:02:40.227212 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0656E130>]}
2020-10-13 03:02:40.228177 (Thread-1): 23:02:40 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.92s]
2020-10-13 03:02:40.231170 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 03:02:40.231170 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 03:02:40.232166 (Thread-1): 23:02:40 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 03:02:40.233465 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:02:40.233465 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 03:02:40.233465 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 03:02:40.241447 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:02:40.242444 (Thread-1): finished collecting timing info
2020-10-13 03:02:40.248428 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:02:40.249427 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 03:02:40.974945 (Thread-1): finished collecting timing info
2020-10-13 03:02:40.974945 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0654CB68>]}
2020-10-13 03:02:40.975942 (Thread-1): 23:02:40 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.74s]
2020-10-13 03:02:40.977939 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 03:02:40.977939 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 03:02:40.978934 (Thread-1): 23:02:40 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 03:02:40.979931 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:02:40.979931 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 03:02:40.979931 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 03:02:40.988418 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:02:40.989418 (Thread-1): finished collecting timing info
2020-10-13 03:02:40.994402 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:02:40.996404 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 03:02:41.760074 (Thread-1): finished collecting timing info
2020-10-13 03:02:41.761072 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x071C92C8>]}
2020-10-13 03:02:41.763067 (Thread-1): 23:02:41 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.78s]
2020-10-13 03:02:41.765079 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 03:02:41.766059 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 03:02:41.768054 (Thread-1): 23:02:41 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 03:02:41.769052 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:02:41.769052 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 03:02:41.769052 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 03:02:41.782041 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:02:41.783013 (Thread-1): finished collecting timing info
2020-10-13 03:02:41.787005 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:02:41.788001 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order.first_order_id,
        orders.amount_total_cents,
        gross_payments.gross_total_amount_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
),

categories as (
    select *,
           case 
                when first_order_id = order_id THEN 'new' 
                else 'repeat' 
           end as user_type,
           case
                when currency = 'USD' then amount_total_cents 
                else gross_total_amount_cents 
           end as total_amount_cents
    from joined
),

final as (
    select 
        *,
        (amount_total_cents / 100) as amount_total, 
        (gross_total_amount_cents/ 100) as gross_total_amount, 
        (total_amount_cents/ 100) as total_amount, 
        (gross_tax_amount_cents/ 100) as gross_tax_amount, 
        (gross_amount_cents/ 100) as gross_amount, 
        (gross_shipping_amount_cents/ 100) as gross_shipping_amount
    from categories 
)

select * from final;


2020-10-13 03:02:42.720053 (Thread-1): finished collecting timing info
2020-10-13 03:02:42.721083 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2baddd68-b512-49c4-80d5-c62560e5170c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x071A0250>]}
2020-10-13 03:02:42.722080 (Thread-1): 23:02:42 | 8 of 8 OK created view model dbt_atambay.order_details............... [CREATE VIEW in 0.95s]
2020-10-13 03:02:42.723058 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 03:02:42.724041 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:02:42.725076 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:02:42.725076 (MainThread): 23:02:42 | 
2020-10-13 03:02:42.727042 (MainThread): 23:02:42 | Finished running 8 view models in 8.54s.
2020-10-13 03:02:42.728031 (MainThread): Connection 'master' was properly closed.
2020-10-13 03:02:42.728031 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 03:02:42.728031 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 03:02:42.728031 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 03:02:42.756952 (MainThread): 
2020-10-13 03:02:42.757950 (MainThread): Completed successfully
2020-10-13 03:02:42.758622 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2020-10-13 03:02:42.760620 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065FD688>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x065FD6E8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x071BE2E0>]}
2020-10-13 03:02:42.760620 (MainThread): Flushing usage events
2020-10-13 03:18:36.755263 (MainThread): Running with dbt=0.17.0
2020-10-13 03:18:37.365143 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 03:18:37.367138 (MainThread): Tracking: tracking
2020-10-13 03:18:37.367138 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x04DA1FB8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05A322C8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05A322E0>]}
2020-10-13 03:18:37.419000 (MainThread): Partial parsing not enabled
2020-10-13 03:18:37.425981 (MainThread): Parsing macros\core.sql
2020-10-13 03:18:37.431964 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 03:18:37.516738 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 03:18:37.530700 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 03:18:37.532694 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 03:18:37.536685 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 03:18:37.540673 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 03:18:37.543665 (MainThread): Parsing macros\etc\query.sql
2020-10-13 03:18:37.544662 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 03:18:37.561619 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 03:18:37.595526 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 03:18:37.598518 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 03:18:37.611484 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 03:18:37.661350 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 03:18:37.726177 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 03:18:37.729170 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 03:18:37.762083 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 03:18:37.778040 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 03:18:37.790008 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 03:18:37.808963 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 03:18:37.813978 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 03:18:37.815978 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 03:18:37.820928 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 03:18:37.828920 (MainThread): Parsing macros\adapters.sql
2020-10-13 03:18:37.858822 (MainThread): Parsing macros\catalog.sql
2020-10-13 03:18:37.869844 (MainThread): Parsing macros\etc.sql
2020-10-13 03:18:37.870825 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 03:18:37.893765 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 03:18:37.897752 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 03:18:37.903734 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 03:18:37.934621 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 03:18:37.974515 (MainThread): Partial parsing not enabled
2020-10-13 03:18:38.043330 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:18:38.044328 (MainThread): Opening a new connection, currently in state init
2020-10-13 03:18:38.093850 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:18:38.093850 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.109819 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:18:38.109819 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.125835 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:18:38.125835 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.142528 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:18:38.142528 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.160479 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:18:38.161477 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.179429 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:18:38.179429 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.194448 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 03:18:38.194448 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.206419 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:18:38.207414 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.364374 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 03:18:38.439144 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 03:18:38.441134 (MainThread): 
2020-10-13 03:18:38.442132 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:18:38.442132 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:38.458152 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 03:18:38.458152 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 03:18:39.170196 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 03:18:39.171195 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 03:18:39.172182 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 03:18:39.764535 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:18:39.764535 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:39.765531 (MainThread): 23:18:39 | Concurrency: 1 threads (target='dev')
2020-10-13 03:18:39.765531 (MainThread): 23:18:39 | 
2020-10-13 03:18:39.773509 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 03:18:39.776501 (Thread-1): 23:18:39 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 03:18:39.787473 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:18:39.787473 (Thread-1): Opening a new connection, currently in state init
2020-10-13 03:18:39.788483 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 03:18:39.835347 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 03:18:39.837348 (Thread-1): finished collecting timing info
2020-10-13 03:18:39.924110 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 03:18:39.926104 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 03:18:41.067183 (Thread-1): finished collecting timing info
2020-10-13 03:18:41.068180 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B4F088>]}
2020-10-13 03:18:41.071171 (Thread-1): 23:18:41 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.28s]
2020-10-13 03:18:41.074167 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 03:18:41.075162 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 03:18:41.078156 (Thread-1): 23:18:41 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 03:18:41.080148 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:18:41.080148 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 03:18:41.080148 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 03:18:41.093113 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 03:18:41.094112 (Thread-1): finished collecting timing info
2020-10-13 03:18:41.102089 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 03:18:41.103087 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 03:18:42.043982 (Thread-1): finished collecting timing info
2020-10-13 03:18:42.045977 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B533A0>]}
2020-10-13 03:18:42.047970 (Thread-1): 23:18:42 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.97s]
2020-10-13 03:18:42.049966 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 03:18:42.049966 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 03:18:42.052958 (Thread-1): 23:18:42 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 03:18:42.053958 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:18:42.054953 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 03:18:42.054953 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 03:18:42.071907 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 03:18:42.074899 (Thread-1): finished collecting timing info
2020-10-13 03:18:42.084872 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 03:18:42.085869 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 03:18:42.967069 (Thread-1): finished collecting timing info
2020-10-13 03:18:42.968066 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BDDFD0>]}
2020-10-13 03:18:42.970061 (Thread-1): 23:18:42 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.91s]
2020-10-13 03:18:42.971056 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 03:18:42.972055 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 03:18:42.976045 (Thread-1): 23:18:42 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 03:18:42.978040 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:18:42.979035 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 03:18:42.979035 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 03:18:42.989010 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:18:42.992014 (Thread-1): finished collecting timing info
2020-10-13 03:18:43.008958 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:18:43.010952 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 03:18:43.918245 (Thread-1): finished collecting timing info
2020-10-13 03:18:43.919245 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B67FD0>]}
2020-10-13 03:18:43.920240 (Thread-1): 23:18:43 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.94s]
2020-10-13 03:18:43.921237 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 03:18:43.922235 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 03:18:43.923231 (Thread-1): 23:18:43 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 03:18:43.927220 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:18:43.927220 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 03:18:43.927220 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 03:18:43.936229 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:18:43.936229 (Thread-1): finished collecting timing info
2020-10-13 03:18:43.944177 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:18:43.945172 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 03:18:44.567933 (Thread-1): finished collecting timing info
2020-10-13 03:18:44.568922 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BAC3A0>]}
2020-10-13 03:18:44.571977 (Thread-1): 23:18:44 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.64s]
2020-10-13 03:18:44.581027 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 03:18:44.581027 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 03:18:44.582055 (Thread-1): 23:18:44 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 03:18:44.584033 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:18:44.584033 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 03:18:44.584033 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 03:18:44.595528 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:18:44.597556 (Thread-1): finished collecting timing info
2020-10-13 03:18:44.604841 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:18:44.605882 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 03:18:45.529621 (Thread-1): finished collecting timing info
2020-10-13 03:18:45.530617 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05B67FD0>]}
2020-10-13 03:18:45.532610 (Thread-1): 23:18:45 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.95s]
2020-10-13 03:18:45.534614 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 03:18:45.534614 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 03:18:45.536565 (Thread-1): 23:18:45 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 03:18:45.537565 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:18:45.537565 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 03:18:45.537565 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 03:18:45.551524 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:18:45.553519 (Thread-1): finished collecting timing info
2020-10-13 03:18:45.564490 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:18:45.567537 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 03:18:46.423302 (Thread-1): finished collecting timing info
2020-10-13 03:18:46.424299 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x067B0220>]}
2020-10-13 03:18:46.426316 (Thread-1): 23:18:46 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.89s]
2020-10-13 03:18:46.429286 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 03:18:46.430284 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 03:18:46.431281 (Thread-1): 23:18:46 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 03:18:46.432685 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:18:46.432685 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 03:18:46.432685 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 03:18:46.450651 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:18:46.451640 (Thread-1): finished collecting timing info
2020-10-13 03:18:46.464608 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:18:46.466603 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order.first_order_id,
        orders.amount_total_cents as order_amount_total_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents,
        gross_payments.gross_total_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
),

categories as (
    select *,
           case 
                when first_order_id = order_id THEN 'new' 
                else 'repeat' 
           end as user_type,

    --confused as to why this logic was used       
           case
                when currency = 'USD' then order_amount_total_cents 
                else gross_total_amount_cents 
           end as total_amount_cents
    from joined
),

final as (
    select 
        *,
        (amount_total_cents / 100) as amount_total,
        (total_amount_cents/ 100) as total_amount, 
        (gross_tax_amount_cents/ 100) as gross_tax_amount, 
        (gross_amount_cents/ 100) as gross_amount, 
        (gross_shipping_amount_cents/ 100) as gross_shipping_amount,
        (gross_total_amount_cents/ 100) as gross_total_amount
    from categories 
)

select * from final;


2020-10-13 03:18:47.017940 (Thread-1): finished collecting timing info
2020-10-13 03:18:47.018939 (Thread-1): Database Error in model order_details (models\transform\order_details.sql)
  Unrecognized name: amount_total_cents at [75:10]
  compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 84, in exception_handler
    yield
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 225, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 352, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\future\polling.py", line 80, in _done_or_raise
    if not self.done():
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\job.py", line 3079, in done
    self._query_results = self._client._get_query_results(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 1286, in _get_query_results
    resource = self._call_api(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\bigquery\client.py", line 556, in _call_api
    return call()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\api_core\retry.py", line 184, in retry_target
    return target()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\google\cloud\_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/fishtown-interview-292223/queries/8183f48b-1058-43e5-b334-eb2dff01999d?maxResults=0&location=US: Unrecognized name: amount_total_cents at [75:10]

(job ID: 8183f48b-1058-43e5-b334-eb2dff01999d)

                                                         -----Query Job SQL Follows-----                                                          

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */
   2:
   3:
   4:  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
   5:  OPTIONS()
   6:  as with orders as (
   7:    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
   8:),
   9:
  10:first_order_device as (
  11:    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  12:),
  13:
  14:first_order as (
  15:    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  16:),
  17:
  18:addresses as (
  19:    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  20:),
  21:
  22:gross_payments as (
  23:    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  24:),
  25:
  26:joined as (
  27:    SELECT
  28:        orders.order_id, 
  29:        orders.user_id, 
  30:        orders.created_at, 
  31:        orders.updated_at, 
  32:        orders.shipped_at, 
  33:        orders.currency, 
  34:        orders.status AS order_status,
  35:        orders.order_status_category,
  36:        addresses.country_type,
  37:        orders.shipping_method,
  38:        first_order_device.purchase_device_type,
  39:        first_order_device.device as purchase_device,
  40:        first_order.first_order_id,
  41:        orders.amount_total_cents as order_amount_total_cents,
  42:        gross_payments.gross_tax_amount_cents, 
  43:        gross_payments.gross_amount_cents, 
  44:        gross_payments.gross_shipping_amount_cents,
  45:        gross_payments.gross_total_amount_cents
  46:    from orders 
  47:    left join first_order_device
  48:    using (order_id)
  49:    left join first_order
  50:    using (user_id)
  51:    left join addresses
  52:    using (order_id)
  53:    left join gross_payments
  54:    using (order_id)
  55:),
  56:
  57:categories as (
  58:    select *,
  59:           case 
  60:                when first_order_id = order_id THEN 'new' 
  61:                else 'repeat' 
  62:           end as user_type,
  63:
  64:    --confused as to why this logic was used       
  65:           case
  66:                when currency = 'USD' then order_amount_total_cents 
  67:                else gross_total_amount_cents 
  68:           end as total_amount_cents
  69:    from joined
  70:),
  71:
  72:final as (
  73:    select 
  74:        *,
  75:        (amount_total_cents / 100) as amount_total,
  76:        (total_amount_cents/ 100) as total_amount, 
  77:        (gross_tax_amount_cents/ 100) as gross_tax_amount, 
  78:        (gross_amount_cents/ 100) as gross_amount, 
  79:        (gross_shipping_amount_cents/ 100) as gross_shipping_amount,
  80:        (gross_total_amount_cents/ 100) as gross_total_amount
  81:    from categories 
  82:)
  83:
  84:select * from final;
  85:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 228, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 171, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 273, in run
    return self.execute(compiled_node, manifest)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\node_runners.py", line 459, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 296, in __call__
    return self.call_macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\clients\jinja.py", line 226, in call_macro
    return macro(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\jinja2\runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\base\impl.py", line 225, in execute
    return self.connections.execute(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 234, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 227, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 359, in _retry_and_handle
    return retry.retry_target(
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 88, in exception_handler
    self.handle_error(e, message)
  File "c:\users\attam\appdata\local\programs\python\python38-32\lib\site-packages\dbt\adapters\bigquery\connections.py", line 76, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model order_details (models\transform\order_details.sql)
  Unrecognized name: amount_total_cents at [75:10]
  compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
2020-10-13 03:18:47.028912 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b87416a-692d-490e-b657-274cea9cde96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BE9EF8>]}
2020-10-13 03:18:47.031903 (Thread-1): 23:18:47 | 8 of 8 ERROR creating view model dbt_atambay.order_details........... [ERROR in 0.60s]
2020-10-13 03:18:47.032900 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 03:18:47.034895 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:18:47.034895 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:18:47.035894 (MainThread): 23:18:47 | 
2020-10-13 03:18:47.038884 (MainThread): 23:18:47 | Finished running 8 view models in 8.59s.
2020-10-13 03:18:47.038884 (MainThread): Connection 'master' was properly closed.
2020-10-13 03:18:47.039885 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 03:18:47.039885 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 03:18:47.039885 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 03:18:47.112252 (MainThread): 
2020-10-13 03:18:47.113250 (MainThread): Completed with 1 error and 0 warnings:
2020-10-13 03:18:47.133200 (MainThread): 
2020-10-13 03:18:47.134194 (MainThread): Database Error in model order_details (models\transform\order_details.sql)
2020-10-13 03:18:47.137191 (MainThread):   Unrecognized name: amount_total_cents at [75:10]
2020-10-13 03:18:47.137191 (MainThread):   compiled SQL at target\run\jaffle_shop\models\transform\order_details.sql
2020-10-13 03:18:47.139180 (MainThread): 
Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
2020-10-13 03:18:47.140177 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x03A7E4D8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BBB550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05BBB7D8>]}
2020-10-13 03:18:47.141175 (MainThread): Flushing usage events
2020-10-13 03:20:45.086115 (MainThread): Running with dbt=0.17.0
2020-10-13 03:20:45.426151 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=['main'], fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='C:\\Users\\attam\\.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-10-13 03:20:45.427107 (MainThread): Tracking: tracking
2020-10-13 03:20:45.427107 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x05651FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062E3358>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x062E33D0>]}
2020-10-13 03:20:45.449051 (MainThread): Partial parsing not enabled
2020-10-13 03:20:45.452086 (MainThread): Parsing macros\core.sql
2020-10-13 03:20:45.456074 (MainThread): Parsing macros\adapters\common.sql
2020-10-13 03:20:45.507933 (MainThread): Parsing macros\etc\datetime.sql
2020-10-13 03:20:45.517915 (MainThread): Parsing macros\etc\get_custom_alias.sql
2020-10-13 03:20:45.518863 (MainThread): Parsing macros\etc\get_custom_database.sql
2020-10-13 03:20:45.520898 (MainThread): Parsing macros\etc\get_custom_schema.sql
2020-10-13 03:20:45.522896 (MainThread): Parsing macros\etc\is_incremental.sql
2020-10-13 03:20:45.524887 (MainThread): Parsing macros\etc\query.sql
2020-10-13 03:20:45.525886 (MainThread): Parsing macros\materializations\helpers.sql
2020-10-13 03:20:45.534860 (MainThread): Parsing macros\materializations\common\merge.sql
2020-10-13 03:20:45.549821 (MainThread): Parsing macros\materializations\incremental\helpers.sql
2020-10-13 03:20:45.551812 (MainThread): Parsing macros\materializations\incremental\incremental.sql
2020-10-13 03:20:45.557800 (MainThread): Parsing macros\materializations\seed\seed.sql
2020-10-13 03:20:45.584164 (MainThread): Parsing macros\materializations\snapshot\snapshot.sql
2020-10-13 03:20:45.617033 (MainThread): Parsing macros\materializations\snapshot\snapshot_merge.sql
2020-10-13 03:20:45.619030 (MainThread): Parsing macros\materializations\snapshot\strategies.sql
2020-10-13 03:20:45.636980 (MainThread): Parsing macros\materializations\table\table.sql
2020-10-13 03:20:45.643961 (MainThread): Parsing macros\materializations\view\create_or_replace_view.sql
2020-10-13 03:20:45.650942 (MainThread): Parsing macros\materializations\view\view.sql
2020-10-13 03:20:45.656968 (MainThread): Parsing macros\schema_tests\accepted_values.sql
2020-10-13 03:20:45.658922 (MainThread): Parsing macros\schema_tests\not_null.sql
2020-10-13 03:20:45.659961 (MainThread): Parsing macros\schema_tests\relationships.sql
2020-10-13 03:20:45.662956 (MainThread): Parsing macros\schema_tests\unique.sql
2020-10-13 03:20:45.665941 (MainThread): Parsing macros\adapters.sql
2020-10-13 03:20:45.684853 (MainThread): Parsing macros\catalog.sql
2020-10-13 03:20:45.695882 (MainThread): Parsing macros\etc.sql
2020-10-13 03:20:45.697864 (MainThread): Parsing macros\materializations\incremental.sql
2020-10-13 03:20:45.710783 (MainThread): Parsing macros\materializations\seed.sql
2020-10-13 03:20:45.712856 (MainThread): Parsing macros\materializations\snapshot.sql
2020-10-13 03:20:45.714818 (MainThread): Parsing macros\materializations\table.sql
2020-10-13 03:20:45.724786 (MainThread): Parsing macros\materializations\view.sql
2020-10-13 03:20:45.749720 (MainThread): Partial parsing not enabled
2020-10-13 03:20:45.786626 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:20:45.786626 (MainThread): Opening a new connection, currently in state init
2020-10-13 03:20:45.814546 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:20:45.815541 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.824517 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:20:45.824517 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.834453 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:20:45.834453 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.845424 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:20:45.845424 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.855395 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:20:45.855395 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.867444 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:20:45.867444 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.876413 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.main".
2020-10-13 03:20:45.876413 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.886355 (MainThread): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:20:45.886355 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:45.999013 (MainThread): WARNING: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop.example

2020-10-13 03:20:46.066470 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 147 macros, 0 operations, 0 seed files, 0 sources
2020-10-13 03:20:46.069539 (MainThread): 
2020-10-13 03:20:46.069539 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:20:46.069539 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:46.089031 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_fishtown-interview-292223".
2020-10-13 03:20:46.090108 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-10-13 03:20:46.727295 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_fishtown-interview-292223_dbt_atambay".
2020-10-13 03:20:46.727295 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2020-10-13 03:20:46.727991 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-10-13 03:20:47.323357 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:20:47.323357 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:47.323357 (MainThread): 23:20:47 | Concurrency: 1 threads (target='dev')
2020-10-13 03:20:47.324355 (MainThread): 23:20:47 | 
2020-10-13 03:20:47.329340 (Thread-1): Began running node model.jaffle_shop.devices
2020-10-13 03:20:47.331336 (Thread-1): 23:20:47 | 1 of 8 START view model dbt_atambay.devices.......................... [RUN]
2020-10-13 03:20:47.339328 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.devices".
2020-10-13 03:20:47.340314 (Thread-1): Opening a new connection, currently in state init
2020-10-13 03:20:47.340314 (Thread-1): Compiling model.jaffle_shop.devices
2020-10-13 03:20:47.371243 (Thread-1): Writing injected SQL for node "model.jaffle_shop.devices"
2020-10-13 03:20:47.373229 (Thread-1): finished collecting timing info
2020-10-13 03:20:47.419102 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.devices"
2020-10-13 03:20:47.421095 (Thread-1): On model.jaffle_shop.devices: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.devices"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`devices`
  OPTIONS()
  as select * from `fa--interview-task.interview.devices`;


2020-10-13 03:20:48.448042 (Thread-1): finished collecting timing info
2020-10-13 03:20:48.449051 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06412EE0>]}
2020-10-13 03:20:48.451034 (Thread-1): 23:20:48 | 1 of 8 OK created view model dbt_atambay.devices..................... [CREATE VIEW in 1.11s]
2020-10-13 03:20:48.452031 (Thread-1): Finished running node model.jaffle_shop.devices
2020-10-13 03:20:48.452031 (Thread-1): Began running node model.jaffle_shop.orders
2020-10-13 03:20:48.453028 (Thread-1): 23:20:48 | 2 of 8 START view model dbt_atambay.orders........................... [RUN]
2020-10-13 03:20:48.454025 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.orders".
2020-10-13 03:20:48.454025 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.devices).
2020-10-13 03:20:48.454025 (Thread-1): Compiling model.jaffle_shop.orders
2020-10-13 03:20:48.467989 (Thread-1): Writing injected SQL for node "model.jaffle_shop.orders"
2020-10-13 03:20:48.468986 (Thread-1): finished collecting timing info
2020-10-13 03:20:48.475971 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.orders"
2020-10-13 03:20:48.476965 (Thread-1): On model.jaffle_shop.orders: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.orders"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`orders`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.orders`
),

xf as (
    select 
        *,
        case
            when status IN ('paid', 'completed', 'shipped') THEN 'completed' 
            else status 
        end as order_status_category
    from base
)

select * from xf;


2020-10-13 03:20:49.076762 (Thread-1): finished collecting timing info
2020-10-13 03:20:49.077759 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06446B98>]}
2020-10-13 03:20:49.079746 (Thread-1): 23:20:49 | 2 of 8 OK created view model dbt_atambay.orders...................... [CREATE VIEW in 0.62s]
2020-10-13 03:20:49.081706 (Thread-1): Finished running node model.jaffle_shop.orders
2020-10-13 03:20:49.081706 (Thread-1): Began running node model.jaffle_shop.payments
2020-10-13 03:20:49.084720 (Thread-1): 23:20:49 | 3 of 8 START view model dbt_atambay.payments......................... [RUN]
2020-10-13 03:20:49.087690 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.payments".
2020-10-13 03:20:49.087690 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.orders).
2020-10-13 03:20:49.087690 (Thread-1): Compiling model.jaffle_shop.payments
2020-10-13 03:20:49.094713 (Thread-1): Writing injected SQL for node "model.jaffle_shop.payments"
2020-10-13 03:20:49.095686 (Thread-1): finished collecting timing info
2020-10-13 03:20:49.101661 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.payments"
2020-10-13 03:20:49.102648 (Thread-1): On model.jaffle_shop.payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`payments`
  OPTIONS()
  as select * from `fa--interview-task.interview.payments`;


2020-10-13 03:20:49.754599 (Thread-1): finished collecting timing info
2020-10-13 03:20:49.755597 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06477778>]}
2020-10-13 03:20:49.756594 (Thread-1): 23:20:49 | 3 of 8 OK created view model dbt_atambay.payments.................... [CREATE VIEW in 0.67s]
2020-10-13 03:20:49.758588 (Thread-1): Finished running node model.jaffle_shop.payments
2020-10-13 03:20:49.758588 (Thread-1): Began running node model.jaffle_shop.addresses
2020-10-13 03:20:49.759665 (Thread-1): 23:20:49 | 4 of 8 START view model dbt_atambay.addresses........................ [RUN]
2020-10-13 03:20:49.762578 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.addresses".
2020-10-13 03:20:49.762578 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.payments).
2020-10-13 03:20:49.762578 (Thread-1): Compiling model.jaffle_shop.addresses
2020-10-13 03:20:49.772552 (Thread-1): Writing injected SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:20:49.772552 (Thread-1): finished collecting timing info
2020-10-13 03:20:49.778536 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.addresses"
2020-10-13 03:20:49.779535 (Thread-1): On model.jaffle_shop.addresses: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.addresses"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`addresses`
  OPTIONS()
  as with base as (
    select * from `fa--interview-task.interview.addresses`
),

xf as (
    select
        *,
        case
            when country_code is null then 'Null country' 
            when country_code = 'US' THEN 'US' 
            else 'International' 
        end as country_type
    from base
)

select * from xf;


2020-10-13 03:20:50.443570 (Thread-1): finished collecting timing info
2020-10-13 03:20:50.443570 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x064019E8>]}
2020-10-13 03:20:50.444568 (Thread-1): 23:20:50 | 4 of 8 OK created view model dbt_atambay.addresses................... [CREATE VIEW in 0.68s]
2020-10-13 03:20:50.445766 (Thread-1): Finished running node model.jaffle_shop.addresses
2020-10-13 03:20:50.446776 (Thread-1): Began running node model.jaffle_shop.first_order_device
2020-10-13 03:20:50.446776 (Thread-1): 23:20:50 | 5 of 8 START view model dbt_atambay.first_order_device............... [RUN]
2020-10-13 03:20:50.448763 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order_device".
2020-10-13 03:20:50.448763 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.addresses).
2020-10-13 03:20:50.448763 (Thread-1): Compiling model.jaffle_shop.first_order_device
2020-10-13 03:20:50.460773 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:20:50.462784 (Thread-1): finished collecting timing info
2020-10-13 03:20:50.470756 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order_device"
2020-10-13 03:20:50.471743 (Thread-1): On model.jaffle_shop.first_order_device: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order_device"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
  OPTIONS()
  as with devices as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`devices`
),

xf as (
    select 
        distinct cast(type_id as int64) as order_id, 
                 first_value(device) OVER (partition by type_id order by created_at 
                                           ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING 
                                          ) as device 
    from devices 
    where type = 'order'
),

categories as (
    select 
        *,
        CASE 
            WHEN device = 'web' THEN 'desktop' 
            WHEN device IN ('ios-app', 'android-app') THEN 'mobile-app' 
            when device IN ('mobile', 'tablet') THEN 'mobile-web' 
            when NULLIF(device, '') IS NULL THEN 'unknown' 
            ELSE 'ERROR' 
        END AS purchase_device_type
    from xf
)

select * from categories;


2020-10-13 03:20:51.395629 (Thread-1): finished collecting timing info
2020-10-13 03:20:51.396626 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x063EE790>]}
2020-10-13 03:20:51.397623 (Thread-1): 23:20:51 | 5 of 8 OK created view model dbt_atambay.first_order_device.......... [CREATE VIEW in 0.95s]
2020-10-13 03:20:51.398621 (Thread-1): Finished running node model.jaffle_shop.first_order_device
2020-10-13 03:20:51.398621 (Thread-1): Began running node model.jaffle_shop.first_order
2020-10-13 03:20:51.400616 (Thread-1): 23:20:51 | 6 of 8 START view model dbt_atambay.first_order...................... [RUN]
2020-10-13 03:20:51.404158 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.first_order".
2020-10-13 03:20:51.404158 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order_device).
2020-10-13 03:20:51.404158 (Thread-1): Compiling model.jaffle_shop.first_order
2020-10-13 03:20:51.413168 (Thread-1): Writing injected SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:20:51.414164 (Thread-1): finished collecting timing info
2020-10-13 03:20:51.420126 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.first_order"
2020-10-13 03:20:51.422150 (Thread-1): On model.jaffle_shop.first_order: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.first_order"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`first_order`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

xf as (
    select 
        user_id, 
        min(order_id) as first_order_id 
    from orders
    where status != 'cancelled' 
    group by user_id
)

select * from xf;


2020-10-13 03:20:52.294000 (Thread-1): finished collecting timing info
2020-10-13 03:20:52.294996 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x06401550>]}
2020-10-13 03:20:52.295996 (Thread-1): 23:20:52 | 6 of 8 OK created view model dbt_atambay.first_order................. [CREATE VIEW in 0.89s]
2020-10-13 03:20:52.296956 (Thread-1): Finished running node model.jaffle_shop.first_order
2020-10-13 03:20:52.297953 (Thread-1): Began running node model.jaffle_shop.gross_payments
2020-10-13 03:20:52.298951 (Thread-1): 23:20:52 | 7 of 8 START view model dbt_atambay.gross_payments................... [RUN]
2020-10-13 03:20:52.300945 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.gross_payments".
2020-10-13 03:20:52.301946 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.first_order).
2020-10-13 03:20:52.301946 (Thread-1): Compiling model.jaffle_shop.gross_payments
2020-10-13 03:20:52.312914 (Thread-1): Writing injected SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:20:52.313911 (Thread-1): finished collecting timing info
2020-10-13 03:20:52.318903 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.gross_payments"
2020-10-13 03:20:52.319941 (Thread-1): On model.jaffle_shop.gross_payments: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.gross_payments"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
  OPTIONS()
  as with payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`payments`
),

xf as (
    select 
        order_id, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN tax_amount_cents 
                ELSE 0 
            END 
            ) as gross_tax_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_cents 
                ELSE 0 
            END
            ) as gross_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN amount_shipping_cents 
                ELSE 0 
            END 
            ) as gross_shipping_amount_cents, 
        sum( 
            CASE 
                WHEN status = 'completed' THEN (tax_amount_cents + amount_cents + amount_shipping_cents)
                ELSE 0 
            END 
            ) as gross_total_amount_cents 
    from payments 
    group by order_id 
)

select * from xf;


2020-10-13 03:20:52.998088 (Thread-1): finished collecting timing info
2020-10-13 03:20:52.999085 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x070611F0>]}
2020-10-13 03:20:53.000082 (Thread-1): 23:20:53 | 7 of 8 OK created view model dbt_atambay.gross_payments.............. [CREATE VIEW in 0.70s]
2020-10-13 03:20:53.001085 (Thread-1): Finished running node model.jaffle_shop.gross_payments
2020-10-13 03:20:53.002082 (Thread-1): Began running node model.jaffle_shop.order_details
2020-10-13 03:20:53.003089 (Thread-1): 23:20:53 | 8 of 8 START view model dbt_atambay.order_details.................... [RUN]
2020-10-13 03:20:53.006091 (Thread-1): Acquiring new bigquery connection "model.jaffle_shop.order_details".
2020-10-13 03:20:53.007082 (Thread-1): Re-using an available connection from the pool (formerly model.jaffle_shop.gross_payments).
2020-10-13 03:20:53.007082 (Thread-1): Compiling model.jaffle_shop.order_details
2020-10-13 03:20:53.020069 (Thread-1): Writing injected SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:20:53.022030 (Thread-1): finished collecting timing info
2020-10-13 03:20:53.026013 (Thread-1): Writing runtime SQL for node "model.jaffle_shop.order_details"
2020-10-13 03:20:53.027036 (Thread-1): On model.jaffle_shop.order_details: /* {"app": "dbt", "dbt_version": "0.17.0", "profile_name": "fishtown", "target_name": "dev", "node_id": "model.jaffle_shop.order_details"} */


  create or replace view `fishtown-interview-292223`.`dbt_atambay`.`order_details`
  OPTIONS()
  as with orders as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`orders`
),

first_order_device as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order_device`
),

first_order as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`first_order`
),

addresses as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`addresses`
),

gross_payments as (
    select * from `fishtown-interview-292223`.`dbt_atambay`.`gross_payments`
),

joined as (
    SELECT
        orders.order_id, 
        orders.user_id, 
        orders.created_at, 
        orders.updated_at, 
        orders.shipped_at, 
        orders.currency, 
        orders.status AS order_status,
        orders.order_status_category,
        addresses.country_type,
        orders.shipping_method,
        first_order_device.purchase_device_type,
        first_order_device.device as purchase_device,
        first_order.first_order_id,
        orders.amount_total_cents as order_amount_total_cents,
        gross_payments.gross_tax_amount_cents, 
        gross_payments.gross_amount_cents, 
        gross_payments.gross_shipping_amount_cents,
        gross_payments.gross_total_amount_cents
    from orders 
    left join first_order_device
    using (order_id)
    left join first_order
    using (user_id)
    left join addresses
    using (order_id)
    left join gross_payments
    using (order_id)
),

categories as (
    select *,
           case 
                when first_order_id = order_id THEN 'new' 
                else 'repeat' 
           end as user_type,

    --confused as to why this logic was used       
           case
                when currency = 'USD' then order_amount_total_cents 
                else gross_total_amount_cents 
           end as total_amount_cents
    from joined
),

final as (
    select 
        *,
        (order_amount_total_cents / 100) as order_amount_total,
        (total_amount_cents/ 100) as total_amount, 
        (gross_tax_amount_cents/ 100) as gross_tax_amount, 
        (gross_amount_cents/ 100) as gross_amount, 
        (gross_shipping_amount_cents/ 100) as gross_shipping_amount,
        (gross_total_amount_cents/ 100) as gross_total_amount
    from categories 
)

select * from final;


2020-10-13 03:20:53.657526 (Thread-1): finished collecting timing info
2020-10-13 03:20:53.657526 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abefb8a2-38c0-4ce8-a924-42b6072fed07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x070611F0>]}
2020-10-13 03:20:53.659493 (Thread-1): 23:20:53 | 8 of 8 OK created view model dbt_atambay.order_details............... [CREATE VIEW in 0.65s]
2020-10-13 03:20:53.661053 (Thread-1): Finished running node model.jaffle_shop.order_details
2020-10-13 03:20:53.662050 (MainThread): Acquiring new bigquery connection "master".
2020-10-13 03:20:53.662050 (MainThread): Opening a new connection, currently in state closed
2020-10-13 03:20:53.662050 (MainThread): 23:20:53 | 
2020-10-13 03:20:53.663096 (MainThread): 23:20:53 | Finished running 8 view models in 7.59s.
2020-10-13 03:20:53.663096 (MainThread): Connection 'master' was properly closed.
2020-10-13 03:20:53.663096 (MainThread): Connection 'list_fishtown-interview-292223' was left open.
2020-10-13 03:20:53.663096 (MainThread): Connection 'list_fishtown-interview-292223_dbt_atambay' was left open.
2020-10-13 03:20:53.664169 (MainThread): Connection 'model.jaffle_shop.order_details' was left open.
2020-10-13 03:20:53.689040 (MainThread): 
2020-10-13 03:20:53.690026 (MainThread): Completed successfully
2020-10-13 03:20:53.696221 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2020-10-13 03:20:53.697237 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0648E5E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0648E1C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0648EEC8>]}
2020-10-13 03:20:53.697237 (MainThread): Flushing usage events
